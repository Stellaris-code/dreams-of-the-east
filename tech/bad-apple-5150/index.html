<!DOCTYPE html><html><head><meta charset="utf-8"><title>Bad Apple on the IBM PC 5150.md</title><style>@charset "UTF-8";@import 'https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0-alpha2/katex.min.css';code{color:#c7254e;background-color:#f9f2f4;border-radius:4px}code,kbd{padding:2px 4px}kbd{color:#fff;background-color:#333;border-radius:3px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}kbd kbd{padding:0;font-size:100%;box-shadow:none}pre{display:block;margin:0 0 10px;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.pre-scrollable{max-height:340px;overflow-y:scroll}table{background-color:transparent}th{text-align:left}.table{width:100%;max-width:100%;margin-bottom:20px}.table>thead>tr>th{padding:8px;line-height:1.4285714;border-top:1px solid #ddd}.table>thead>tr>td,.table>tbody>tr>th,.table>tbody>tr>td,.table>tfoot>tr>th,.table>tfoot>tr>td{padding:8px;line-height:1.4285714;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>caption+thead>tr:first-child>th,.table>caption+thead>tr:first-child>td,.table>colgroup+thead>tr:first-child>th,.table>colgroup+thead>tr:first-child>td,.table>thead:first-child>tr:first-child>th,.table>thead:first-child>tr:first-child>td{border-top:0}.table>tbody+tbody{border-top:2px solid #ddd}.table .table{background-color:#fff}.table-condensed>thead>tr>th,.table-condensed>thead>tr>td,.table-condensed>tbody>tr>th,.table-condensed>tbody>tr>td,.table-condensed>tfoot>tr>th,.table-condensed>tfoot>tr>td{padding:5px}.table-bordered,.table-bordered>thead>tr>th,.table-bordered>thead>tr>td,.table-bordered>tbody>tr>th,.table-bordered>tbody>tr>td,.table-bordered>tfoot>tr>th,.table-bordered>tfoot>tr>td{border:1px solid #ddd}.table-bordered>thead>tr>th,.table-bordered>thead>tr>td{border-bottom-width:2px}.table-striped>tbody>tr:nth-child(odd)>td,.table-striped>tbody>tr:nth-child(odd)>th{background-color:#f9f9f9}.table-hover>tbody>tr:hover>td,.table-hover>tbody>tr:hover>th{background-color:#f5f5f5}table col[class*="col-"]{position:static;float:none;display:table-column}table td[class*="col-"],table th[class*="col-"]{position:static;float:none;display:table-cell}.table>thead>tr>td.active,.table>thead>tr>th.active,.table>thead>tr.active>td,.table>thead>tr.active>th,.table>tbody>tr>td.active,.table>tbody>tr>th.active,.table>tbody>tr.active>td,.table>tbody>tr.active>th,.table>tfoot>tr>td.active,.table>tfoot>tr>th.active,.table>tfoot>tr.active>td,.table>tfoot>tr.active>th{background-color:#f5f5f5}.table-hover>tbody>tr>td.active:hover,.table-hover>tbody>tr>th.active:hover,.table-hover>tbody>tr.active:hover>td,.table-hover>tbody>tr:hover>.active,.table-hover>tbody>tr.active:hover>th{background-color:#e8e8e8}.table>thead>tr>td.success,.table>thead>tr>th.success,.table>thead>tr.success>td,.table>thead>tr.success>th,.table>tbody>tr>td.success,.table>tbody>tr>th.success,.table>tbody>tr.success>td,.table>tbody>tr.success>th,.table>tfoot>tr>td.success,.table>tfoot>tr>th.success,.table>tfoot>tr.success>td,.table>tfoot>tr.success>th{background-color:#dff0d8}.table-hover>tbody>tr>td.success:hover,.table-hover>tbody>tr>th.success:hover,.table-hover>tbody>tr.success:hover>td,.table-hover>tbody>tr:hover>.success,.table-hover>tbody>tr.success:hover>th{background-color:#d0e9c6}.table>thead>tr>td.info,.table>thead>tr>th.info,.table>thead>tr.info>td,.table>thead>tr.info>th,.table>tbody>tr>td.info,.table>tbody>tr>th.info,.table>tbody>tr.info>td,.table>tbody>tr.info>th,.table>tfoot>tr>td.info,.table>tfoot>tr>th.info,.table>tfoot>tr.info>td,.table>tfoot>tr.info>th{background-color:#d9edf7}.table-hover>tbody>tr>td.info:hover,.table-hover>tbody>tr>th.info:hover,.table-hover>tbody>tr.info:hover>td,.table-hover>tbody>tr:hover>.info,.table-hover>tbody>tr.info:hover>th{background-color:#c4e3f3}.table>thead>tr>td.warning,.table>thead>tr>th.warning,.table>thead>tr.warning>td,.table>thead>tr.warning>th,.table>tbody>tr>td.warning,.table>tbody>tr>th.warning,.table>tbody>tr.warning>td,.table>tbody>tr.warning>th,.table>tfoot>tr>td.warning,.table>tfoot>tr>th.warning,.table>tfoot>tr.warning>td,.table>tfoot>tr.warning>th{background-color:#fcf8e3}.table-hover>tbody>tr>td.warning:hover,.table-hover>tbody>tr>th.warning:hover,.table-hover>tbody>tr.warning:hover>td,.table-hover>tbody>tr:hover>.warning,.table-hover>tbody>tr.warning:hover>th{background-color:#faf2cc}.table>thead>tr>td.danger,.table>thead>tr>th.danger,.table>thead>tr.danger>td,.table>thead>tr.danger>th,.table>tbody>tr>td.danger,.table>tbody>tr>th.danger,.table>tbody>tr.danger>td,.table>tbody>tr.danger>th,.table>tfoot>tr>td.danger,.table>tfoot>tr>th.danger,.table>tfoot>tr.danger>td,.table>tfoot>tr.danger>th{background-color:#f2dede}.table-hover>tbody>tr>td.danger:hover,.table-hover>tbody>tr>th.danger:hover,.table-hover>tbody>tr.danger:hover>td,.table-hover>tbody>tr:hover>.danger,.table-hover>tbody>tr.danger:hover>th{background-color:#ebcccc}fieldset{border:0;min-width:0}legend{display:block;width:100%;margin-bottom:20px;font-size:21px;line-height:inherit;color:#333;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type="radio"],input[type="checkbox"]{margin:4px 0 0;margin-top:1px \9;line-height:normal}input[type="file"]{display:block}input[type="range"]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type="file"]:focus,input[type="radio"]:focus,input[type="checkbox"]:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}output{padding-top:7px}output,.form-control{display:block;font-size:14px;line-height:1.4285714;color:#555}.form-control{width:100%;height:34px;padding:6px 12px;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;box-shadow:inset 0 1px 1px rgba(0,0,0,.075);transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#777;opacity:1}.form-control:-ms-input-placeholder{color:#777}.form-control::-webkit-input-placeholder{color:#777}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{cursor:not-allowed;background-color:#eee;opacity:1}textarea.form-control{height:auto}input[type="date"],input[type="time"],input[type="datetime-local"],input[type="month"]{line-height:34px;line-height:1.4285714 \0}input[type="date"].input-sm,.form-horizontal .form-group-sm input.form-control[type="date"],.input-group-sm>input.form-control[type="date"],.input-group-sm>input.input-group-addon[type="date"],.input-group-sm>.input-group-btn>input.btn[type="date"],input[type="time"].input-sm,.form-horizontal .form-group-sm input.form-control[type="time"],.input-group-sm>input.form-control[type="time"],.input-group-sm>input.input-group-addon[type="time"],.input-group-sm>.input-group-btn>input.btn[type="time"],input[type="datetime-local"].input-sm,.form-horizontal .form-group-sm input.form-control[type="datetime-local"],.input-group-sm>input.form-control[type="datetime-local"],.input-group-sm>input.input-group-addon[type="datetime-local"],.input-group-sm>.input-group-btn>input.btn[type="datetime-local"],input[type="month"].input-sm,.form-horizontal .form-group-sm input.form-control[type="month"],.input-group-sm>input.form-control[type="month"],.input-group-sm>input.input-group-addon[type="month"],.input-group-sm>.input-group-btn>input.btn[type="month"]{line-height:30px}input[type="date"].input-lg,.form-horizontal .form-group-lg input.form-control[type="date"],.input-group-lg>input.form-control[type="date"],.input-group-lg>input.input-group-addon[type="date"],.input-group-lg>.input-group-btn>input.btn[type="date"],input[type="time"].input-lg,.form-horizontal .form-group-lg input.form-control[type="time"],.input-group-lg>input.form-control[type="time"],.input-group-lg>input.input-group-addon[type="time"],.input-group-lg>.input-group-btn>input.btn[type="time"],input[type="datetime-local"].input-lg,.form-horizontal .form-group-lg input.form-control[type="datetime-local"],.input-group-lg>input.form-control[type="datetime-local"],.input-group-lg>input.input-group-addon[type="datetime-local"],.input-group-lg>.input-group-btn>input.btn[type="datetime-local"],input[type="month"].input-lg,.form-horizontal .form-group-lg input.form-control[type="month"],.input-group-lg>input.form-control[type="month"],.input-group-lg>input.input-group-addon[type="month"],.input-group-lg>.input-group-btn>input.btn[type="month"]{line-height:46px}.form-group{margin-bottom:15px}.radio,.checkbox{position:relative;display:block;min-height:20px;margin-top:10px;margin-bottom:10px}.radio label,.checkbox label{padding-left:20px;margin-bottom:0;font-weight:400;cursor:pointer}.radio input[type="radio"],.radio-inline input[type="radio"],.checkbox input[type="checkbox"],.checkbox-inline input[type="checkbox"]{position:absolute;margin-left:-20px;margin-top:4px \9}.radio+.radio,.checkbox+.checkbox{margin-top:-5px}.radio-inline,.checkbox-inline{display:inline-block;padding-left:20px;margin-bottom:0;vertical-align:middle;font-weight:400;cursor:pointer}.radio-inline+.radio-inline,.checkbox-inline+.checkbox-inline{margin-top:0;margin-left:10px}input[type="radio"][disabled],input[type="radio"].disabled,fieldset[disabled] input[type="radio"],input[type="checkbox"][disabled],input[type="checkbox"].disabled,fieldset[disabled] input[type="checkbox"],.radio-inline.disabled,fieldset[disabled] .radio-inline,.checkbox-inline.disabled,fieldset[disabled] .checkbox-inline,.radio.disabled label,fieldset[disabled] .radio label,.checkbox.disabled label,fieldset[disabled] .checkbox label{cursor:not-allowed}.form-control-static{padding-top:7px;padding-bottom:7px;margin-bottom:0}.form-control-static.input-lg,.form-horizontal .form-group-lg .form-control-static.form-control,.input-group-lg>.form-control-static.form-control,.input-group-lg>.form-control-static.input-group-addon,.input-group-lg>.input-group-btn>.form-control-static.btn,.form-control-static.input-sm,.form-horizontal .form-group-sm .form-control-static.form-control,.input-group-sm>.form-control-static.form-control,.input-group-sm>.form-control-static.input-group-addon,.input-group-sm>.input-group-btn>.form-control-static.btn{padding-left:0;padding-right:0}.input-sm,.form-horizontal .form-group-sm .form-control,.input-group-sm>.form-control{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}.input-group-sm>.input-group-addon{height:30px;line-height:1.5}.input-group-sm>.input-group-btn>.btn{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.input-sm,.form-horizontal .form-group-sm select.form-control,.input-group-sm>select.form-control,.input-group-sm>select.input-group-addon,.input-group-sm>.input-group-btn>select.btn{height:30px;line-height:30px}textarea.input-sm,.form-horizontal .form-group-sm textarea.form-control,.input-group-sm>textarea.form-control,.input-group-sm>textarea.input-group-addon,.input-group-sm>.input-group-btn>textarea.btn,select[multiple].input-sm,.form-horizontal .form-group-sm select.form-control[multiple],.input-group-sm>select.form-control[multiple],.input-group-sm>select.input-group-addon[multiple],.input-group-sm>.input-group-btn>select.btn[multiple]{height:auto}.input-lg,.form-horizontal .form-group-lg .form-control,.input-group-lg>.form-control{height:46px;padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px}.input-group-lg>.input-group-addon{height:46px;line-height:1.33}.input-group-lg>.input-group-btn>.btn{height:46px;padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px}select.input-lg,.form-horizontal .form-group-lg select.form-control,.input-group-lg>select.form-control,.input-group-lg>select.input-group-addon,.input-group-lg>.input-group-btn>select.btn{height:46px;line-height:46px}textarea.input-lg,.form-horizontal .form-group-lg textarea.form-control,.input-group-lg>textarea.form-control,.input-group-lg>textarea.input-group-addon,.input-group-lg>.input-group-btn>textarea.btn,select[multiple].input-lg,.form-horizontal .form-group-lg select.form-control[multiple],.input-group-lg>select.form-control[multiple],.input-group-lg>select.input-group-addon[multiple],.input-group-lg>.input-group-btn>select.btn[multiple]{height:auto}.has-feedback{position:relative}.has-feedback .form-control{padding-right:42.5px}.form-control-feedback{position:absolute;top:25px;right:0;z-index:2;display:block;width:34px;height:34px;line-height:34px;text-align:center}.input-lg+.form-control-feedback,.form-horizontal .form-group-lg .form-control+.form-control-feedback,.input-group-lg>.form-control+.form-control-feedback,.input-group-lg>.input-group-addon+.form-control-feedback,.input-group-lg>.input-group-btn>.btn+.form-control-feedback{width:46px;height:46px;line-height:46px}.input-sm+.form-control-feedback,.form-horizontal .form-group-sm .form-control+.form-control-feedback,.input-group-sm>.form-control+.form-control-feedback,.input-group-sm>.input-group-addon+.form-control-feedback,.input-group-sm>.input-group-btn>.btn+.form-control-feedback{width:30px;height:30px;line-height:30px}.has-success .help-block,.has-success .control-label,.has-success .radio,.has-success .checkbox,.has-success .radio-inline,.has-success .checkbox-inline{color:#3c763d}.has-success .form-control{border-color:#3c763d;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-success .form-control:focus{border-color:#2b542c;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168}.has-success .input-group-addon{color:#3c763d;border-color:#3c763d;background-color:#dff0d8}.has-success .form-control-feedback{color:#3c763d}.has-warning .help-block,.has-warning .control-label,.has-warning .radio,.has-warning .checkbox,.has-warning .radio-inline,.has-warning .checkbox-inline{color:#8a6d3b}.has-warning .form-control{border-color:#8a6d3b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-warning .form-control:focus{border-color:#66512c;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b}.has-warning .input-group-addon{color:#8a6d3b;border-color:#8a6d3b;background-color:#fcf8e3}.has-warning .form-control-feedback{color:#8a6d3b}.has-error .help-block,.has-error .control-label,.has-error .radio,.has-error .checkbox,.has-error .radio-inline,.has-error .checkbox-inline{color:#a94442}.has-error .form-control{border-color:#a94442;box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-error .form-control:focus{border-color:#843534;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483}.has-error .input-group-addon{color:#a94442;border-color:#a94442;background-color:#f2dede}.has-error .form-control-feedback{color:#a94442}.has-feedback label.sr-only~.form-control-feedback{top:0}.help-block{display:block;margin-top:5px;margin-bottom:10px;color:#737373}.form-horizontal .radio,.form-horizontal .checkbox,.form-horizontal .radio-inline,.form-horizontal .checkbox-inline{margin-top:0;margin-bottom:0;padding-top:7px}.form-horizontal .radio,.form-horizontal .checkbox{min-height:27px}.form-horizontal .form-group{margin-left:-15px;margin-right:-15px}.form-horizontal .form-group:before{content:" ";display:table}.form-horizontal .form-group:after{content:" ";display:table;clear:both}.form-horizontal .has-feedback .form-control-feedback{top:0;right:15px}.btn{display:inline-block;vertical-align:middle;cursor:pointer;background-image:none;border:1px solid transparent;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.btn:focus,.btn:active:focus,.btn.active:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn:hover,.btn:focus{color:#333;text-decoration:none}.btn:active,.btn.active{outline:0;background-image:none;box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{cursor:not-allowed;pointer-events:none;opacity:.65;filter:alpha(opacity=65);box-shadow:none}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default:hover,.btn-default:focus,.btn-default:active,.btn-default.active,.open>.btn-default.dropdown-toggle{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default:active,.btn-default.active,.open>.btn-default.dropdown-toggle{background-image:none}.btn-default.disabled,.btn-default.disabled:hover,.btn-default.disabled:focus,.btn-default.disabled:active,.btn-default.disabled.active,.btn-default[disabled],.btn-default[disabled]:hover,.btn-default[disabled]:focus,.btn-default[disabled]:active,.btn-default[disabled].active,fieldset[disabled] .btn-default,fieldset[disabled] .btn-default:hover,fieldset[disabled] .btn-default:focus,fieldset[disabled] .btn-default:active,fieldset[disabled] .btn-default.active{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#428bca;border-color:#357ebd}.btn-primary:hover,.btn-primary:focus,.btn-primary:active,.btn-primary.active,.open>.btn-primary.dropdown-toggle{color:#fff;background-color:#3071a9;border-color:#285e8e}.btn-primary:active,.btn-primary.active,.open>.btn-primary.dropdown-toggle{background-image:none}.btn-primary.disabled,.btn-primary.disabled:hover,.btn-primary.disabled:focus,.btn-primary.disabled:active,.btn-primary.disabled.active,.btn-primary[disabled],.btn-primary[disabled]:hover,.btn-primary[disabled]:focus,.btn-primary[disabled]:active,.btn-primary[disabled].active,fieldset[disabled] .btn-primary,fieldset[disabled] .btn-primary:hover,fieldset[disabled] .btn-primary:focus,fieldset[disabled] .btn-primary:active,fieldset[disabled] .btn-primary.active{background-color:#428bca;border-color:#357ebd}.btn-primary .badge{color:#428bca;background-color:#fff}.btn-success{color:#fff;background-color:#5cb85c;border-color:#4cae4c}.btn-success:hover,.btn-success:focus,.btn-success:active,.btn-success.active,.open>.btn-success.dropdown-toggle{color:#fff;background-color:#449d44;border-color:#398439}.btn-success:active,.btn-success.active,.open>.btn-success.dropdown-toggle{background-image:none}.btn-success.disabled,.btn-success.disabled:hover,.btn-success.disabled:focus,.btn-success.disabled:active,.btn-success.disabled.active,.btn-success[disabled],.btn-success[disabled]:hover,.btn-success[disabled]:focus,.btn-success[disabled]:active,.btn-success[disabled].active,fieldset[disabled] .btn-success,fieldset[disabled] .btn-success:hover,fieldset[disabled] .btn-success:focus,fieldset[disabled] .btn-success:active,fieldset[disabled] .btn-success.active{background-color:#5cb85c;border-color:#4cae4c}.btn-success .badge{color:#5cb85c;background-color:#fff}.btn-info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.btn-info:hover,.btn-info:focus,.btn-info:active,.btn-info.active,.open>.btn-info.dropdown-toggle{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info:active,.btn-info.active,.open>.btn-info.dropdown-toggle{background-image:none}.btn-info.disabled,.btn-info.disabled:hover,.btn-info.disabled:focus,.btn-info.disabled:active,.btn-info.disabled.active,.btn-info[disabled],.btn-info[disabled]:hover,.btn-info[disabled]:focus,.btn-info[disabled]:active,.btn-info[disabled].active,fieldset[disabled] .btn-info,fieldset[disabled] .btn-info:hover,fieldset[disabled] .btn-info:focus,fieldset[disabled] .btn-info:active,fieldset[disabled] .btn-info.active{background-color:#5bc0de;border-color:#46b8da}.btn-info .badge{color:#5bc0de;background-color:#fff}.btn-warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.btn-warning:hover,.btn-warning:focus,.btn-warning:active,.btn-warning.active,.open>.btn-warning.dropdown-toggle{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning:active,.btn-warning.active,.open>.btn-warning.dropdown-toggle{background-image:none}.btn-warning.disabled,.btn-warning.disabled:hover,.btn-warning.disabled:focus,.btn-warning.disabled:active,.btn-warning.disabled.active,.btn-warning[disabled],.btn-warning[disabled]:hover,.btn-warning[disabled]:focus,.btn-warning[disabled]:active,.btn-warning[disabled].active,fieldset[disabled] .btn-warning,fieldset[disabled] .btn-warning:hover,fieldset[disabled] .btn-warning:focus,fieldset[disabled] .btn-warning:active,fieldset[disabled] .btn-warning.active{background-color:#f0ad4e;border-color:#eea236}.btn-warning .badge{color:#f0ad4e;background-color:#fff}.btn-danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.btn-danger:hover,.btn-danger:focus,.btn-danger:active,.btn-danger.active,.open>.btn-danger.dropdown-toggle{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger:active,.btn-danger.active,.open>.btn-danger.dropdown-toggle{background-image:none}.btn-danger.disabled,.btn-danger.disabled:hover,.btn-danger.disabled:focus,.btn-danger.disabled:active,.btn-danger.disabled.active,.btn-danger[disabled],.btn-danger[disabled]:hover,.btn-danger[disabled]:focus,.btn-danger[disabled]:active,.btn-danger[disabled].active,fieldset[disabled] .btn-danger,fieldset[disabled] .btn-danger:hover,fieldset[disabled] .btn-danger:focus,fieldset[disabled] .btn-danger:active,fieldset[disabled] .btn-danger.active{background-color:#d9534f;border-color:#d43f3a}.btn-danger .badge{color:#d9534f;background-color:#fff}.btn-link{color:#428bca;font-weight:400;cursor:pointer;border-radius:0}.btn-link,.btn-link:active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;box-shadow:none}.btn-link,.btn-link:hover,.btn-link:focus,.btn-link:active{border-color:transparent}.btn-link:hover,.btn-link:focus{color:#2a6496;text-decoration:underline;background-color:transparent}.btn-link[disabled]:hover,.btn-link[disabled]:focus,fieldset[disabled] .btn-link:hover,fieldset[disabled] .btn-link:focus{color:#777;text-decoration:none}.btn-lg{padding:10px 16px;font-size:18px;line-height:1.33;border-radius:6px}.btn-sm{padding:5px 10px}.btn-sm,.btn-xs{font-size:12px;line-height:1.5;border-radius:3px}.btn-xs{padding:1px 5px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:5px}input[type="submit"].btn-block,input[type="reset"].btn-block,input[type="button"].btn-block{width:100%}.fade{opacity:0;transition:opacity .15s linear}.fade.in{opacity:1}.collapse{display:none}.collapse.in{display:block}tr.collapse.in{display:table-row}tbody.collapse.in{display:table-row-group}.collapsing{position:relative;height:0;overflow:hidden;transition:height .35s ease}.input-group{position:relative;display:table;border-collapse:separate}.input-group[class*="col-"]{float:none;padding-left:0;padding-right:0}.input-group .form-control{position:relative;z-index:2;float:left;width:100%;margin-bottom:0}.input-group-addon,.input-group-btn,.input-group .form-control{display:table-cell}.input-group-addon:not(:first-child):not(:last-child),.input-group-btn:not(:first-child):not(:last-child),.input-group .form-control:not(:first-child):not(:last-child){border-radius:0}.input-group-addon{white-space:nowrap}.input-group-addon,.input-group-btn{width:1%;vertical-align:middle}.input-group-addon{padding:6px 12px;font-size:14px;font-weight:400;line-height:1;color:#555;text-align:center;background-color:#eee;border:1px solid #ccc;border-radius:4px}.input-group-addon.input-sm,.form-horizontal .form-group-sm .input-group-addon.form-control,.input-group-sm>.input-group-addon,.input-group-sm>.input-group-btn>.input-group-addon.btn{padding:5px 10px;font-size:12px;border-radius:3px}.input-group-addon.input-lg,.form-horizontal .form-group-lg .input-group-addon.form-control,.input-group-lg>.input-group-addon,.input-group-lg>.input-group-btn>.input-group-addon.btn{padding:10px 16px;font-size:18px;border-radius:6px}.input-group-addon input[type="radio"],.input-group-addon input[type="checkbox"]{margin-top:0}.input-group .form-control:first-child,.input-group-addon:first-child,.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group>.btn,.input-group-btn:first-child>.dropdown-toggle,.input-group-btn:last-child>.btn:not(:last-child):not(.dropdown-toggle),.input-group-btn:last-child>.btn-group:not(:last-child)>.btn{border-bottom-right-radius:0;border-top-right-radius:0}.input-group-addon:first-child{border-right:0}.input-group .form-control:last-child,.input-group-addon:last-child,.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group>.btn,.input-group-btn:last-child>.dropdown-toggle,.input-group-btn:first-child>.btn:not(:first-child),.input-group-btn:first-child>.btn-group:not(:first-child)>.btn{border-bottom-left-radius:0;border-top-left-radius:0}.input-group-addon:last-child{border-left:0}.input-group-btn{font-size:0;white-space:nowrap}.input-group-btn,.input-group-btn>.btn{position:relative}.input-group-btn>.btn+.btn{margin-left:-1px}.input-group-btn>.btn:hover,.input-group-btn>.btn:focus,.input-group-btn>.btn:active{z-index:2}.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group{margin-right:-1px}.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group{margin-left:-1px}.pagination{display:inline-block;padding-left:0;margin:20px 0;border-radius:4px}.pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:6px 12px;line-height:1.4285714;text-decoration:none;color:#428bca;background-color:#fff;border:1px solid #ddd;margin-left:-1px}.pagination>li:first-child>a,.pagination>li:first-child>span{margin-left:0;border-bottom-left-radius:4px;border-top-left-radius:4px}.pagination>li:last-child>a,.pagination>li:last-child>span{border-bottom-right-radius:4px;border-top-right-radius:4px}.pagination>li>a:hover,.pagination>li>a:focus,.pagination>li>span:hover,.pagination>li>span:focus{color:#2a6496;background-color:#eee;border-color:#ddd}.pagination>.active>a,.pagination>.active>a:hover,.pagination>.active>a:focus,.pagination>.active>span,.pagination>.active>span:hover,.pagination>.active>span:focus{z-index:2;color:#fff;background-color:#428bca;border-color:#428bca;cursor:default}.pagination>.disabled>span,.pagination>.disabled>span:hover,.pagination>.disabled>span:focus,.pagination>.disabled>a,.pagination>.disabled>a:hover,.pagination>.disabled>a:focus{color:#777;background-color:#fff;border-color:#ddd;cursor:not-allowed}.pagination-lg>li>a,.pagination-lg>li>span{padding:10px 16px;font-size:18px}.pagination-lg>li:first-child>a,.pagination-lg>li:first-child>span{border-bottom-left-radius:6px;border-top-left-radius:6px}.pagination-lg>li:last-child>a,.pagination-lg>li:last-child>span{border-bottom-right-radius:6px;border-top-right-radius:6px}.pagination-sm>li>a,.pagination-sm>li>span{padding:5px 10px;font-size:12px}.pagination-sm>li:first-child>a,.pagination-sm>li:first-child>span{border-bottom-left-radius:3px;border-top-left-radius:3px}.pagination-sm>li:last-child>a,.pagination-sm>li:last-child>span{border-bottom-right-radius:3px;border-top-right-radius:3px}.close{float:right;font-size:21px;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:.2;filter:alpha(opacity=20)}.close:hover,.close:focus{color:#000;text-decoration:none;cursor:pointer;opacity:.5;filter:alpha(opacity=50)}button.close{padding:0;cursor:pointer;background:0 0;border:0;-webkit-appearance:none}.modal-open,.modal{overflow:hidden}.modal{display:none;position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;-webkit-overflow-scrolling:touch;outline:0}.modal.fade .modal-dialog{transform:translate3d(0,-25%,0);transition:transform .3s ease-out}.modal.in .modal-dialog{transform:translate3d(0,0,0)}.modal-open .modal{overflow-x:hidden;overflow-y:auto}.modal-dialog{position:relative;width:auto;margin:10px}.modal-content{position:relative;background-color:#fff;border:1px solid #999;border:1px solid rgba(0,0,0,.2);border-radius:6px;box-shadow:0 3px 9px rgba(0,0,0,.5);background-clip:padding-box;outline:0}.modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000}.modal-backdrop.fade{opacity:0;filter:alpha(opacity=0)}.modal-backdrop.in{opacity:.5;filter:alpha(opacity=50)}.modal-header{padding:15px;border-bottom:1px solid #e5e5e5;min-height:16.4285714px}.modal-header .close{margin-top:-2px}.modal-title{margin:0;line-height:1.4285714}.modal-body{position:relative;padding:15px}.modal-footer{padding:15px;text-align:right;border-top:1px solid #e5e5e5}.modal-footer:before,.modal-footer:after{content:" ";display:table}.modal-footer:after{clear:both}.modal-footer .btn+.btn{margin-left:5px;margin-bottom:0}.modal-footer .btn-group .btn+.btn{margin-left:-1px}.modal-footer .btn-block+.btn-block{margin-left:0}.modal-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.center-block{display:block;margin-left:auto;margin-right:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important;visibility:hidden!important}.affix{position:fixed;transform:translate3d(0,0,0)}.hljs{display:block;overflow-x:auto;padding:.5em;background:#002b36;color:#839496;-webkit-text-size-adjust:none}.hljs-comment,.hljs-template_comment,.diff .hljs-header,.hljs-doctype,.hljs-pi,.lisp .hljs-string,.hljs-javadoc{color:#586e75}.hljs-keyword,.hljs-winutils,.method,.hljs-addition,.css .hljs-tag,.hljs-request,.hljs-status,.nginx .hljs-title{color:#859900}.hljs-number,.hljs-command,.hljs-string,.hljs-tag .hljs-value,.hljs-rules .hljs-value,.hljs-phpdoc,.hljs-dartdoc,.tex .hljs-formula,.hljs-regexp,.hljs-hexcolor,.hljs-link_url{color:#2aa198}.hljs-title,.hljs-localvars,.hljs-chunk,.hljs-decorator,.hljs-built_in,.hljs-identifier,.vhdl .hljs-literal,.hljs-id,.css .hljs-function{color:#268bd2}.hljs-attribute,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number,.hljs-constant,.hljs-class .hljs-title,.hljs-parent,.hljs-type,.hljs-link_reference{color:#b58900}.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-pragma,.hljs-shebang,.hljs-symbol,.hljs-symbol .hljs-string,.diff .hljs-change,.hljs-special,.hljs-attr_selector,.hljs-subst,.hljs-cdata,.css .hljs-pseudo,.hljs-header{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#073642}*,*:before,*:after{box-sizing:border-box}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background:0 0}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}images{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd{font-size:1em}code,kbd,pre,samp{font-family:monospace,monospace}samp{font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0;margin-right:5px}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}.debug{background-color:#ffc0cb!important}.ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ir{background-color:transparent;border:0;overflow:hidden}.ir::before{content:'';display:block;height:150%;width:0}html{font-size:.875em;background:#fff;color:#373D49}html,body{font-family:Georgia,Cambria,serif;height:100%}body{font-size:1rem;font-weight:400;line-height:2rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}li{font-feature-settings:'kern' 1,'onum' 1,'liga' 1;margin-left:1rem}li>ul,li>ol{margin-bottom:0}p{padding-top:.66001rem;font-feature-settings:'kern' 1,'onum' 1,'liga' 1;margin-top:0}p,pre{margin-bottom:1.33999rem}pre{font-size:1rem;padding:.66001rem 9.5px 9.5px;line-height:2rem;background:linear-gradient(to bottom,#fff 0,#fff .75rem,#f5f7fa .75rem,#f5f7fa 2.75rem,#fff 2.75rem,#fff 4rem);background-size:100% 4rem;border-color:#D3DAEA}blockquote{margin:0}blockquote p{font-size:1rem;margin-bottom:.33999rem;font-style:italic;padding:.66001rem 1rem 1rem;border-left:3px solid #A0AABF}th,td{padding:12px}h1,h2,h3,h4,h5,h6{font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-feature-settings:'dlig' 1,'liga' 1,'lnum' 1,'kern' 1;font-style:normal;font-weight:600;margin-top:0}h1{line-height:3rem;font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h2,h3{line-height:3rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}a{cursor:pointer;color:#35D7BB;text-decoration:none}a:hover,a:focus{border-bottom-color:#35D7BB;color:#dff9f4}img{height:auto;max-width:100%}dt{font-style:italic;font-weight:600}.g{display:block}.g:after{clear:both;content:'';display:table}.g-b{float:left;margin:0;width:100%}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--center{display:block;float:none;margin:0 auto}.g-b--right{float:right}.g-b--1of1{width:100%}.g-b--1of2,.g-b--2of4,.g-b--3of6,.g-b--4of8,.g-b--5of10,.g-b--6of12{width:50%}.g-b--1of3,.g-b--2of6,.g-b--4of12{width:33.333%}.g-b--2of3,.g-b--4of6,.g-b--8of12{width:66.666%}.g-b--1of4,.g-b--2of8,.g-b--3of12{width:25%}.g-b--3of4,.g-b--6of8,.g-b--9of12{width:75%}.g-b--1of5,.g-b--2of10{width:20%}.g-b--2of5,.g-b--4of10{width:40%}.g-b--3of5,.g-b--6of10{width:60%}.g-b--4of5,.g-b--8of10{width:80%}.g-b--1of6,.g-b--2of12{width:16.666%}.g-b--5of6,.g-b--10of12{width:83.333%}.g-b--1of8{width:12.5%}.g-b--3of8{width:37.5%}.g-b--5of8{width:62.5%}.g-b--7of8{width:87.5%}.g-b--1of10{width:10%}.g-b--3of10{width:30%}.g-b--7of10{width:70%}.g-b--9of10{width:90%}.g-b--1of12{width:8.333%}.g-b--5of12{width:41.666%}.g-b--7of12{width:58.333%}.g-b--11of12{width:91.666%}.g-b--push--1of1{margin-left:100%}.g-b--push--1of2,.g-b--push--2of4,.g-b--push--3of6,.g-b--push--4of8,.g-b--push--5of10,.g-b--push--6of12{margin-left:50%}.g-b--push--1of3,.g-b--push--2of6,.g-b--push--4of12{margin-left:33.333%}.g-b--push--2of3,.g-b--push--4of6,.g-b--push--8of12{margin-left:66.666%}.g-b--push--1of4,.g-b--push--2of8,.g-b--push--3of12{margin-left:25%}.g-b--push--3of4,.g-b--push--6of8,.g-b--push--9of12{margin-left:75%}.g-b--push--1of5,.g-b--push--2of10{margin-left:20%}.g-b--push--2of5,.g-b--push--4of10{margin-left:40%}.g-b--push--3of5,.g-b--push--6of10{margin-left:60%}.g-b--push--4of5,.g-b--push--8of10{margin-left:80%}.g-b--push--1of6,.g-b--push--2of12{margin-left:16.666%}.g-b--push--5of6,.g-b--push--10of12{margin-left:83.333%}.g-b--push--1of8{margin-left:12.5%}.g-b--push--3of8{margin-left:37.5%}.g-b--push--5of8{margin-left:62.5%}.g-b--push--7of8{margin-left:87.5%}.g-b--push--1of10{margin-left:10%}.g-b--push--3of10{margin-left:30%}.g-b--push--7of10{margin-left:70%}.g-b--push--9of10{margin-left:90%}.g-b--push--1of12{margin-left:8.333%}.g-b--push--5of12{margin-left:41.666%}.g-b--push--7of12{margin-left:58.333%}.g-b--push--11of12{margin-left:91.666%}.g-b--pull--1of1{margin-right:100%}.g-b--pull--1of2,.g-b--pull--2of4,.g-b--pull--3of6,.g-b--pull--4of8,.g-b--pull--5of10,.g-b--pull--6of12{margin-right:50%}.g-b--pull--1of3,.g-b--pull--2of6,.g-b--pull--4of12{margin-right:33.333%}.g-b--pull--2of3,.g-b--pull--4of6,.g-b--pull--8of12{margin-right:66.666%}.g-b--pull--1of4,.g-b--pull--2of8,.g-b--pull--3of12{margin-right:25%}.g-b--pull--3of4,.g-b--pull--6of8,.g-b--pull--9of12{margin-right:75%}.g-b--pull--1of5,.g-b--pull--2of10{margin-right:20%}.g-b--pull--2of5,.g-b--pull--4of10{margin-right:40%}.g-b--pull--3of5,.g-b--pull--6of10{margin-right:60%}.g-b--pull--4of5,.g-b--pull--8of10{margin-right:80%}.g-b--pull--1of6,.g-b--pull--2of12{margin-right:16.666%}.g-b--pull--5of6,.g-b--pull--10of12{margin-right:83.333%}.g-b--pull--1of8{margin-right:12.5%}.g-b--pull--3of8{margin-right:37.5%}.g-b--pull--5of8{margin-right:62.5%}.g-b--pull--7of8{margin-right:87.5%}.g-b--pull--1of10{margin-right:10%}.g-b--pull--3of10{margin-right:30%}.g-b--pull--7of10{margin-right:70%}.g-b--pull--9of10{margin-right:90%}.g-b--pull--1of12{margin-right:8.333%}.g-b--pull--5of12{margin-right:41.666%}.g-b--pull--7of12{margin-right:58.333%}.g-b--pull--11of12{margin-right:91.666%}.splashscreen{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#373D49;z-index:22}.splashscreen-dillinger{width:260px;height:auto;display:block;margin:0 auto;padding-bottom:3rem}.splashscreen p{font-size:1.25rem;padding-top:.56251rem;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;text-align:center;max-width:500px;margin:0 auto;color:#FFF}.sp-center{position:relative;transform:translateY(-50%);top:50%}.open-menu>.wrapper{overflow-x:hidden}.page{margin:0 auto;position:relative;top:0;left:0;width:100%;height:100%;z-index:2;transition:all .25s ease-in-out;background-color:#fff;padding-top:51px;will-change:left}.open-menu .page{left:270px}.title{line-height:1rem;font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem;font-weight:500;color:#A0AABF;letter-spacing:1px;text-transform:uppercase;padding-left:16px;padding-right:16px;margin-top:1rem}.split-preview .title{padding-left:0}.title-document{line-height:1rem;font-size:1.25rem;margin-bottom:.89999rem;padding-top:.10001rem;font-weight:400;font-family:"Ubuntu Mono",Monaco;color:#373D49;padding-left:16px;padding-right:16px;width:80%;min-width:300px;outline:0;border:none}.icon{display:block;margin:0 auto;width:36px;height:36px;border-radius:3px;text-align:center}.icon svg{display:inline-block;margin-left:auto;margin-right:auto}.icon-preview{background-color:#373D49;line-height:40px}.icon-preview svg{width:19px;height:12px}.icon-settings{background-color:#373D49;line-height:44px}.icon-settings svg{width:18px;height:18px}.icon-link{width:16px;height:16px;line-height:1;margin-right:24px;text-align:right}.navbar{background-color:#373D49;height:51px;width:100%;position:fixed;top:0;left:0;z-index:6;transition:all .25s ease-in-out;will-change:left}.navbar:after{content:"";display:table;clear:both}.open-menu .navbar{left:270px}.navbar-brand{float:left;margin:0 0 0 24px;padding:0;line-height:42px}.navbar-brand svg{width:85px;height:11px}.nav-left{float:left}.nav-right{float:right}.nav-sidebar{width:100%}.menu{list-style:none;margin:0;padding:0}.menu a{border:0;color:#A0AABF;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;outline:none;text-transform:uppercase}.menu a:hover{color:#35D7BB}.menu .menu-item{border:0;display:none;float:left;margin:0;position:relative}.menu .menu-item>a{display:block;font-size:12px;height:51px;letter-spacing:1px;line-height:51px;padding:0 24px}.menu .menu-item--settings,.menu .menu-item--preview,.menu .menu-item--save-to.in-sidebar,.menu .menu-item--import-from.in-sidebar,.menu .menu-item--link-unlink.in-sidebar,.menu .menu-item--documents.in-sidebar{display:block}.menu .menu-item--documents{padding-bottom:1rem}.menu .menu-item.open>a{background-color:#1D212A}.menu .menu-item-icon>a{height:auto;padding:0}.menu .menu-item-icon:hover>a{background-color:transparent}.menu .menu-link.open i{background-color:#1D212A}.menu .menu-link.open g{fill:#35D7BB}.menu .menu-link-preview,.menu .menu-link-settings{margin-top:8px;width:51px}.menu-sidebar{width:100%}.menu-sidebar .menu-item{float:none;margin-bottom:1px;width:100%}.menu-sidebar .menu-item.open>a{background-color:#373D49}.menu-sidebar .open .caret{transform:rotate(180deg)}.menu-sidebar>.menu-item:hover .dropdown a,.menu-sidebar>.menu-item:hover .settings a{background-color:transparent}.menu-sidebar .menu-link{background-color:#373D49;font-weight:600}.menu-sidebar .menu-link:after{content:"";display:table;clear:both}.menu-sidebar .menu-link>span{float:left}.menu-sidebar .menu-link>.caret{float:right;text-align:right;top:22px}.menu-sidebar .dropdown,.menu-sidebar .settings{background-color:transparent;position:static;width:100%}.dropdown{position:absolute;right:0;top:51px;width:188px}.dropdown,.settings{display:none;background-color:#1D212A}.dropdown{padding:0}.dropdown,.settings,.sidebar-list{list-style:none;margin:0}.sidebar-list{padding:0}.dropdown li{margin:32px 0;padding:0 0 0 32px}.dropdown li,.settings li{line-height:1}.sidebar-list li{line-height:1;margin:32px 0;padding:0 0 0 32px}.dropdown a{color:#D0D6E2}.dropdown a,.settings a,.sidebar-list a{display:block;text-transform:none}.sidebar-list a{color:#D0D6E2}.dropdown a:after,.settings a:after,.sidebar-list a:after{content:"";display:table;clear:both}.dropdown .icon,.settings .icon,.sidebar-list .icon{float:right}.open .dropdown,.open .settings,.open .sidebar-list{display:block}.open .dropdown.collapse,.open .collapse.settings,.open .sidebar-list.collapse{display:none}.open .dropdown.collapse.in,.open .collapse.in.settings,.open .sidebar-list.collapse.in{display:block}.dropdown .unlinked .icon,.settings .unlinked .icon,.sidebar-list .unlinked .icon{opacity:.3}.dropdown.documents li,.documents.settings li,.sidebar-list.documents li{background-image:url("../img/icons/file.svg");background-position:240px center;background-repeat:no-repeat;background-size:14px 16px;padding:3px 32px}.dropdown.documents li.octocat,.documents.settings li.octocat,.sidebar-list.documents li.octocat{background-image:url("../img/icons/octocat.svg");background-position:234px center;background-size:24px 24px}.dropdown.documents li:last-child,.documents.settings li:last-child,.sidebar-list.documents li:last-child{margin-bottom:1rem}.dropdown.documents li.active a,.documents.settings li.active a,.sidebar-list.documents li.active a{color:#35D7BB}.settings{position:fixed;top:67px;right:16px;border-radius:3px;width:288px;background-color:#373D49;padding:16px;z-index:7}.show-settings .settings{display:block}.settings .has-checkbox{float:left}.settings form{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:justify;justify-content:space-between}.settings input{width:20%}.settings a{font-size:1.25rem;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;-webkit-font-smoothing:antialiased;line-height:28px;color:#D0D6E2}.settings a:after{content:"";display:table;clear:both}.settings a:hover{color:#35D7BB}.settings li{border-bottom:1px solid #4F535B;margin:0;padding:16px 0}.settings li:last-child{border-bottom:none}.brand{border:none;display:block}.brand:hover g{fill:#35D7BB}.toggle{display:block;float:left;height:16px;padding:25px 16px 26px;width:40px}.toggle span:after,.toggle span:before{content:'';left:0;position:absolute;top:-6px}.toggle span:after{top:6px}.toggle span{display:block;position:relative}.toggle span,.toggle span:after,.toggle span:before{-webkit-backface-visibility:hidden;backface-visibility:hidden;background-color:#D3DAEA;height:2px;transition:all .3s;width:20px}.open-menu .toggle span{background-color:transparent}.open-menu .toggle span:before{transform:rotate(45deg) translate(3px,3px)}.open-menu .toggle span:after{transform:rotate(-45deg) translate(5px,-6px)}.caret{display:inline-block;width:0;height:0;margin-left:6px;vertical-align:middle;position:relative;top:-1px;border-top:4px solid;border-right:4px solid transparent;border-left:4px solid transparent}.sidebar{overflow:auto;height:100%;padding-right:15px;padding-bottom:15px;width:285px}.sidebar-wrapper{-webkit-overflow-scrolling:touch;background-color:#2B2F36;left:0;height:100%;overflow-y:hidden;position:fixed;top:0;width:285px;z-index:1}.sidebar-branding{width:160px;padding:0;margin:16px auto}.header{border-bottom:1px solid #E8E8E8;position:relative}.words,.characters{line-height:1rem;font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem;font-weight:500;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;letter-spacing:1px;text-transform:uppercase;z-index:5;position:absolute;right:16px;top:0}.words span,.characters span{color:#A0AABF}.words .counter,.characters .counter{color:#000}.words+.characters{top:22px}.mr10{margin-right:10px}.btn{text-align:center;display:inline-block;width:100%;text-transform:uppercase;font-weight:600;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;text-shadow:0 1px 0 #1b8b77;padding:16px 24px;background-color:#35D7BB;border-radius:3px;margin:0 auto 16px;line-height:1;color:#fff;transition:all .15s linear;-webkit-font-smoothing:antialiased}.btn--new,.btn--save{display:block;width:238px}.btn--new:hover,.btn--new:focus,.btn--save:hover,.btn--save:focus{color:#fff;border-bottom-color:transparent;box-shadow:0 1px 3px #24b59c;text-shadow:0 1px 0 #24b59c}.btn--save{background-color:#4A5261;text-shadow:0 1px 1px #1e2127}.btn--save:hover,.btn--save:focus{color:#fff;border-bottom-color:transparent;box-shadow:0 1px 5px #08090a;text-shadow:none}.btn--delete{display:block;width:238px;background-color:transparent;font-size:12px;text-shadow:none}.btn--delete:hover,.btn--delete:focus{color:#fff;border-bottom-color:transparent;text-shadow:0 1px 0 #08090a;opacity:.8}.btn--delete-modal,.btn--ok,.btn--close{border-top:0;background-color:#4A5261;text-shadow:0 1px 0 #08090a;margin:0}.btn--delete-modal:hover,.btn--delete-modal:focus,.btn--ok:hover,.btn--ok:focus,.btn--close:hover,.btn--close:focus{color:#fff;background-color:#292d36;text-shadow:none}.btn--delete-modal{display:inline;width:auto}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(55,61,73,.8);transition:all .25s ease-in-out;transition-timing-function:ease-out;will-change:left,opacity,visibility;z-index:5;opacity:0;visibility:hidden}.show-settings .overlay{visibility:visible;opacity:1}.switch{float:right;line-height:1}.switch input{display:none}.switch small{display:inline-block;cursor:pointer;padding:0 24px 0 0;transition:all ease .2s;background-color:#2B2F36;border-color:#2B2F36}.switch small,.switch small:before{border-radius:30px;box-shadow:inset 0 0 2px 0 #14171F}.switch small:before{display:block;content:'';width:28px;height:28px;background:#fff}.switch.checked small{padding-right:0;padding-left:24px;background-color:#35D7BB;box-shadow:none}.modal--dillinger.about .modal-dialog{font-size:1.25rem;max-width:500px}.modal--dillinger.scope .modal-dialog{max-width:300px;margin:5rem auto}.modal--dillinger .modal-dialog{max-width:600px;width:auto;margin:5rem auto}.modal--dillinger .modal-content{background:#373D49;border-radius:3px;box-shadow:0 2px 5px 0 #2C3B59;color:#fff;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;padding:2rem}.modal--dillinger ul{list-style-type:disc;margin:1rem 0;padding:0 0 0 1rem}.modal--dillinger li{padding:0;margin:0}.modal--dillinger .modal-header{border:0;padding:0}.modal--dillinger .modal-body{padding:0}.modal--dillinger .modal-footer{border:0;padding:0}.modal--dillinger .close{color:#fff;opacity:1}.modal-backdrop{background-color:#373D49}.pagination--dillinger{padding:0!important;margin:1.5rem 0!important;display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-direction:row;flex-direction:row;-ms-flex-align:center;align-items:center;-ms-flex-line-pack:stretch;align-content:stretch}.pagination--dillinger li{display:-ms-flexbox;display:flex;-ms-flex-positive:1;flex-grow:1;text-align:center}.pagination--dillinger li:first-child>a,.pagination--dillinger li.disabled>a,.pagination--dillinger li.disabled>a:hover,.pagination--dillinger li.disabled>a:focus,.pagination--dillinger li>a{background-color:transparent;border-color:#4F535B;border-right-color:transparent}.pagination--dillinger li.active>a,.pagination--dillinger li.active>a:hover,.pagination--dillinger li.active>a:focus{border-color:#4A5261;background-color:#4A5261;color:#fff}.pagination--dillinger li>a{float:none;color:#fff;width:100%;display:block;text-align:center;margin:0;border-right-color:transparent;padding:6px}.pagination--dillinger li>a:hover,.pagination--dillinger li>a:focus{border-color:#35D7BB;background-color:#35D7BB;color:#fff}.pagination--dillinger li:last-child a{border-color:#4F535B}.pagination--dillinger li:first-child a{border-right-color:transparent}.diNotify{position:absolute;z-index:9999;left:0;right:0;top:0;margin:0 auto;max-width:400px;text-align:center;transition:top .5s ease-in-out,opacity .5s ease-in-out;visibility:hidden}.diNotify-body{-webkit-font-smoothing:antialiased;background-color:#35D7BB;background:#666E7F;border-radius:3px;color:#fff;font-family:"Source Sans Pro","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;overflow:hidden;padding:1rem 2rem .5rem;display:-ms-flexbox;display:flex;-ms-flex-align:baseline;align-items:baseline;-ms-flex-pack:center;justify-content:center}.diNotify-icon{display:block;width:16px;height:16px;line-height:16px;position:relative;top:3px}.diNotify-message{padding-left:1rem}.zen-wrapper{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:10;background-color:#FFF;opacity:0;transition:opacity .25s ease-in-out}.zen-wrapper.on{opacity:1}.enter-zen-mode{background-image:url("../img/icons/enter-zen.svg");right:.5rem;top:.313rem;display:none}.enter-zen-mode,.close-zen-mode{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;background-repeat:no-repeat;width:32px;height:32px;display:block;position:absolute}.close-zen-mode{background-image:url("../img/icons/exit-zen.svg");right:1rem;top:1rem}.zen-page{position:relative;top:0;bottom:0;z-index:11;height:100%;width:100%}#zen{font-size:1.25rem;width:300px;height:80%;margin:0 auto;position:relative;top:10%}#zen:before,#zen:after{content:"";position:absolute;height:10%;width:100%;z-index:12;pointer-events:none}#preview .table{width:auto}.ui-resizable{position:relative}.ui-resizable-handle{position:absolute;font-size:.1px;z-index:99999;display:block}.ui-resizable-e{background-color:#666;border-right:8px solid #e8e8e8;border-left:1px solid #222;width:10px;z-index:88!important;position:relative}.ui-resizable-e:after{content:"-";display:block;position:absolute;top:calc(50% - 16px);left:0;height:25px;width:2px;background-color:rgba(0,0,0,.4);margin:3px}#editor{cursor:ew-resize;position:relative;z-index:auto}.profile-pic{float:left;width:250px}#_default_ a::before{color:#A0AABF}#_default_ img{display:none}#_default_ #_default_{display:block;float:left;max-width:38%;word-wrap:break-word}#_default_ .default-ad{display:none}#_default_ ._default_{display:block}#_default_ a{color:#35d7bb;text-decoration:none}#_default_ a:hover{color:#8ae8d8}#_default_ .default-image{display:none}#_default_ .default-title:after{content:" — "}#_default_ .default-title,#_default_ .default-text,#_default_ .default-description{display:inline}#_default_ .default-title{position:relative;font-weight:600;display:none}#_default_ a:before{position:relative;top:0;padding:5px;color:#a0aabf;content:"Ad";text-transform:uppercase;font-size:8px;font-family:Verdana,sans-serif}#_default_{display:block;float:left;max-width:38%;word-wrap:break-word}#_default_ ._default_{display:block;font-size:.75rem;height:51px;letter-spacing:1px;line-height:1rem;padding:18px 24px}body{max-width:1024px;margin:0 auto;overflow:auto;padding:2%}.split{overflow:scroll;padding:0!important;-webkit-overflow-scrolling:touch}.split-editor{padding-left:0;padding-right:0;position:relative;z-index:3}.show-preview .split-editor{display:none}.split-preview{background-color:#fff;display:none;top:0;position:relative;z-index:4}.show-preview .split-preview{display:block}#editor{font-size:1rem;font-family:"Ubuntu Mono",Monaco;font-weight:400;line-height:2rem;width:100%;height:100%}#editor .ace_gutter{-webkit-font-smoothing:antialiased}.editor-header{width:50%;float:left;border-bottom:1px solid #E8E8E8;position:relative}.editor-header--first{border-right:1px solid #E8E8E8}.editor-header .title{display:inline-block}.preview-html{padding:15px}.preview-html a{color:#A0AABF;text-decoration:underline}.preview-src{white-space:normal}.preview-mode-toggle-src{background-image:url("../img/icons/code.svg")}.preview-mode-toggle-src,.preview-mode-toggle-html{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0;background-repeat:no-repeat;width:32px;height:32px;display:block;position:absolute;right:.5rem;top:.5rem;display:none}.preview-mode-toggle-html{background-image:url("../img/icons/eye.svg")}.sr-only{visibility:hidden;text-overflow:110%;overflow:hidden;top:-100px;position:absolute}.mnone{margin:0!important}@media screen and (min-width:27.5em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--m1of1{width:100%}.g-b--m1of2,.g-b--m2of4,.g-b--m3of6,.g-b--m4of8,.g-b--m5of10,.g-b--m6of12{width:50%}.g-b--m1of3,.g-b--m2of6,.g-b--m4of12{width:33.333%}.g-b--m2of3,.g-b--m4of6,.g-b--m8of12{width:66.666%}.g-b--m1of4,.g-b--m2of8,.g-b--m3of12{width:25%}.g-b--m3of4,.g-b--m6of8,.g-b--m9of12{width:75%}.g-b--m1of5,.g-b--m2of10{width:20%}.g-b--m2of5,.g-b--m4of10{width:40%}.g-b--m3of5,.g-b--m6of10{width:60%}.g-b--m4of5,.g-b--m8of10{width:80%}.g-b--m1of6,.g-b--m2of12{width:16.666%}.g-b--m5of6,.g-b--m10of12{width:83.333%}.g-b--m1of8{width:12.5%}.g-b--m3of8{width:37.5%}.g-b--m5of8{width:62.5%}.g-b--m7of8{width:87.5%}.g-b--m1of10{width:10%}.g-b--m3of10{width:30%}.g-b--m7of10{width:70%}.g-b--m9of10{width:90%}.g-b--m1of12{width:8.333%}.g-b--m5of12{width:41.666%}.g-b--m7of12{width:58.333%}.g-b--m11of12{width:91.666%}.g-b--push--m1of1{margin-left:100%}.g-b--push--m1of2,.g-b--push--m2of4,.g-b--push--m3of6,.g-b--push--m4of8,.g-b--push--m5of10,.g-b--push--m6of12{margin-left:50%}.g-b--push--m1of3,.g-b--push--m2of6,.g-b--push--m4of12{margin-left:33.333%}.g-b--push--m2of3,.g-b--push--m4of6,.g-b--push--m8of12{margin-left:66.666%}.g-b--push--m1of4,.g-b--push--m2of8,.g-b--push--m3of12{margin-left:25%}.g-b--push--m3of4,.g-b--push--m6of8,.g-b--push--m9of12{margin-left:75%}.g-b--push--m1of5,.g-b--push--m2of10{margin-left:20%}.g-b--push--m2of5,.g-b--push--m4of10{margin-left:40%}.g-b--push--m3of5,.g-b--push--m6of10{margin-left:60%}.g-b--push--m4of5,.g-b--push--m8of10{margin-left:80%}.g-b--push--m1of6,.g-b--push--m2of12{margin-left:16.666%}.g-b--push--m5of6,.g-b--push--m10of12{margin-left:83.333%}.g-b--push--m1of8{margin-left:12.5%}.g-b--push--m3of8{margin-left:37.5%}.g-b--push--m5of8{margin-left:62.5%}.g-b--push--m7of8{margin-left:87.5%}.g-b--push--m1of10{margin-left:10%}.g-b--push--m3of10{margin-left:30%}.g-b--push--m7of10{margin-left:70%}.g-b--push--m9of10{margin-left:90%}.g-b--push--m1of12{margin-left:8.333%}.g-b--push--m5of12{margin-left:41.666%}.g-b--push--m7of12{margin-left:58.333%}.g-b--push--m11of12{margin-left:91.666%}.g-b--pull--m1of1{margin-right:100%}.g-b--pull--m1of2,.g-b--pull--m2of4,.g-b--pull--m3of6,.g-b--pull--m4of8,.g-b--pull--m5of10,.g-b--pull--m6of12{margin-right:50%}.g-b--pull--m1of3,.g-b--pull--m2of6,.g-b--pull--m4of12{margin-right:33.333%}.g-b--pull--m2of3,.g-b--pull--m4of6,.g-b--pull--m8of12{margin-right:66.666%}.g-b--pull--m1of4,.g-b--pull--m2of8,.g-b--pull--m3of12{margin-right:25%}.g-b--pull--m3of4,.g-b--pull--m6of8,.g-b--pull--m9of12{margin-right:75%}.g-b--pull--m1of5,.g-b--pull--m2of10{margin-right:20%}.g-b--pull--m2of5,.g-b--pull--m4of10{margin-right:40%}.g-b--pull--m3of5,.g-b--pull--m6of10{margin-right:60%}.g-b--pull--m4of5,.g-b--pull--m8of10{margin-right:80%}.g-b--pull--m1of6,.g-b--pull--m2of12{margin-right:16.666%}.g-b--pull--m5of6,.g-b--pull--m10of12{margin-right:83.333%}.g-b--pull--m1of8{margin-right:12.5%}.g-b--pull--m3of8{margin-right:37.5%}.g-b--pull--m5of8{margin-right:62.5%}.g-b--pull--m7of8{margin-right:87.5%}.g-b--pull--m1of10{margin-right:10%}.g-b--pull--m3of10{margin-right:30%}.g-b--pull--m7of10{margin-right:70%}.g-b--pull--m9of10{margin-right:90%}.g-b--pull--m1of12{margin-right:8.333%}.g-b--pull--m5of12{margin-right:41.666%}.g-b--pull--m7of12{margin-right:58.333%}.g-b--pull--m11of12{margin-right:91.666%}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{margin-bottom:.89999rem;padding-top:.10001rem}.title-document,.settings a{font-size:1.25rem}.words,.characters{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog,#zen{font-size:1.25rem}#zen{width:400px}#editor{font-size:1rem}}@media screen and (min-width:46.25em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--t1of1{width:100%}.g-b--t1of2,.g-b--t2of4,.g-b--t3of6,.g-b--t4of8,.g-b--t5of10,.g-b--t6of12{width:50%}.g-b--t1of3,.g-b--t2of6,.g-b--t4of12{width:33.333%}.g-b--t2of3,.g-b--t4of6,.g-b--t8of12{width:66.666%}.g-b--t1of4,.g-b--t2of8,.g-b--t3of12{width:25%}.g-b--t3of4,.g-b--t6of8,.g-b--t9of12{width:75%}.g-b--t1of5,.g-b--t2of10{width:20%}.g-b--t2of5,.g-b--t4of10{width:40%}.g-b--t3of5,.g-b--t6of10{width:60%}.g-b--t4of5,.g-b--t8of10{width:80%}.g-b--t1of6,.g-b--t2of12{width:16.666%}.g-b--t5of6,.g-b--t10of12{width:83.333%}.g-b--t1of8{width:12.5%}.g-b--t3of8{width:37.5%}.g-b--t5of8{width:62.5%}.g-b--t7of8{width:87.5%}.g-b--t1of10{width:10%}.g-b--t3of10{width:30%}.g-b--t7of10{width:70%}.g-b--t9of10{width:90%}.g-b--t1of12{width:8.333%}.g-b--t5of12{width:41.666%}.g-b--t7of12{width:58.333%}.g-b--t11of12{width:91.666%}.g-b--push--t1of1{margin-left:100%}.g-b--push--t1of2,.g-b--push--t2of4,.g-b--push--t3of6,.g-b--push--t4of8,.g-b--push--t5of10,.g-b--push--t6of12{margin-left:50%}.g-b--push--t1of3,.g-b--push--t2of6,.g-b--push--t4of12{margin-left:33.333%}.g-b--push--t2of3,.g-b--push--t4of6,.g-b--push--t8of12{margin-left:66.666%}.g-b--push--t1of4,.g-b--push--t2of8,.g-b--push--t3of12{margin-left:25%}.g-b--push--t3of4,.g-b--push--t6of8,.g-b--push--t9of12{margin-left:75%}.g-b--push--t1of5,.g-b--push--t2of10{margin-left:20%}.g-b--push--t2of5,.g-b--push--t4of10{margin-left:40%}.g-b--push--t3of5,.g-b--push--t6of10{margin-left:60%}.g-b--push--t4of5,.g-b--push--t8of10{margin-left:80%}.g-b--push--t1of6,.g-b--push--t2of12{margin-left:16.666%}.g-b--push--t5of6,.g-b--push--t10of12{margin-left:83.333%}.g-b--push--t1of8{margin-left:12.5%}.g-b--push--t3of8{margin-left:37.5%}.g-b--push--t5of8{margin-left:62.5%}.g-b--push--t7of8{margin-left:87.5%}.g-b--push--t1of10{margin-left:10%}.g-b--push--t3of10{margin-left:30%}.g-b--push--t7of10{margin-left:70%}.g-b--push--t9of10{margin-left:90%}.g-b--push--t1of12{margin-left:8.333%}.g-b--push--t5of12{margin-left:41.666%}.g-b--push--t7of12{margin-left:58.333%}.g-b--push--t11of12{margin-left:91.666%}.g-b--pull--t1of1{margin-right:100%}.g-b--pull--t1of2,.g-b--pull--t2of4,.g-b--pull--t3of6,.g-b--pull--t4of8,.g-b--pull--t5of10,.g-b--pull--t6of12{margin-right:50%}.g-b--pull--t1of3,.g-b--pull--t2of6,.g-b--pull--t4of12{margin-right:33.333%}.g-b--pull--t2of3,.g-b--pull--t4of6,.g-b--pull--t8of12{margin-right:66.666%}.g-b--pull--t1of4,.g-b--pull--t2of8,.g-b--pull--t3of12{margin-right:25%}.g-b--pull--t3of4,.g-b--pull--t6of8,.g-b--pull--t9of12{margin-right:75%}.g-b--pull--t1of5,.g-b--pull--t2of10{margin-right:20%}.g-b--pull--t2of5,.g-b--pull--t4of10{margin-right:40%}.g-b--pull--t3of5,.g-b--pull--t6of10{margin-right:60%}.g-b--pull--t4of5,.g-b--pull--t8of10{margin-right:80%}.g-b--pull--t1of6,.g-b--pull--t2of12{margin-right:16.666%}.g-b--pull--t5of6,.g-b--pull--t10of12{margin-right:83.333%}.g-b--pull--t1of8{margin-right:12.5%}.g-b--pull--t3of8{margin-right:37.5%}.g-b--pull--t5of8{margin-right:62.5%}.g-b--pull--t7of8{margin-right:87.5%}.g-b--pull--t1of10{margin-right:10%}.g-b--pull--t3of10{margin-right:30%}.g-b--pull--t7of10{margin-right:70%}.g-b--pull--t9of10{margin-right:90%}.g-b--pull--t1of12{margin-right:8.333%}.g-b--pull--t5of12{margin-right:41.666%}.g-b--pull--t7of12{margin-right:58.333%}.g-b--pull--t11of12{margin-right:91.666%}.splashscreen-dillinger{width:500px}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{font-size:1.25rem;margin-bottom:.89999rem;padding-top:.10001rem}.menu .menu-item--save-to,.menu .menu-item--import-from{display:block}.menu .menu-item--preview,.menu .menu-item--save-to.in-sidebar,.menu .menu-item--import-from.in-sidebar{display:none}.settings a{font-size:1.25rem}.words,.characters{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog{font-size:1.25rem}.enter-zen-mode{display:block}.close-zen-mode{right:3rem;top:3rem}#zen{font-size:1.25rem;width:500px}.split-editor{border-right:1px solid #E8E8E8;float:left;padding-right:16px;width:50%}.show-preview .split-editor{display:block}.split-preview{display:block;float:right;position:relative;top:0;width:50%}#editor{font-size:1rem}.preview-mode-toggle-src,.preview-mode-toggle-html{display:block}}@media screen and (min-width:62.5em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.g{margin-left:-16px;margin-right:-16px}.g-b{padding-left:16px;padding-right:16px}.g-b--d1of1{width:100%}.g-b--d1of2,.g-b--d2of4,.g-b--d3of6,.g-b--d4of8,.g-b--d5of10,.g-b--d6of12{width:50%}.g-b--d1of3,.g-b--d2of6,.g-b--d4of12{width:33.333%}.g-b--d2of3,.g-b--d4of6,.g-b--d8of12{width:66.666%}.g-b--d1of4,.g-b--d2of8,.g-b--d3of12{width:25%}.g-b--d3of4,.g-b--d6of8,.g-b--d9of12{width:75%}.g-b--d1of5,.g-b--d2of10{width:20%}.g-b--d2of5,.g-b--d4of10{width:40%}.g-b--d3of5,.g-b--d6of10{width:60%}.g-b--d4of5,.g-b--d8of10{width:80%}.g-b--d1of6,.g-b--d2of12{width:16.666%}.g-b--d5of6,.g-b--d10of12{width:83.333%}.g-b--d1of8{width:12.5%}.g-b--d3of8{width:37.5%}.g-b--d5of8{width:62.5%}.g-b--d7of8{width:87.5%}.g-b--d1of10{width:10%}.g-b--d3of10{width:30%}.g-b--d7of10{width:70%}.g-b--d9of10{width:90%}.g-b--d1of12{width:8.333%}.g-b--d5of12{width:41.666%}.g-b--d7of12{width:58.333%}.g-b--d11of12{width:91.666%}.g-b--push--d1of1{margin-left:100%}.g-b--push--d1of2,.g-b--push--d2of4,.g-b--push--d3of6,.g-b--push--d4of8,.g-b--push--d5of10,.g-b--push--d6of12{margin-left:50%}.g-b--push--d1of3,.g-b--push--d2of6,.g-b--push--d4of12{margin-left:33.333%}.g-b--push--d2of3,.g-b--push--d4of6,.g-b--push--d8of12{margin-left:66.666%}.g-b--push--d1of4,.g-b--push--d2of8,.g-b--push--d3of12{margin-left:25%}.g-b--push--d3of4,.g-b--push--d6of8,.g-b--push--d9of12{margin-left:75%}.g-b--push--d1of5,.g-b--push--d2of10{margin-left:20%}.g-b--push--d2of5,.g-b--push--d4of10{margin-left:40%}.g-b--push--d3of5,.g-b--push--d6of10{margin-left:60%}.g-b--push--d4of5,.g-b--push--d8of10{margin-left:80%}.g-b--push--d1of6,.g-b--push--d2of12{margin-left:16.666%}.g-b--push--d5of6,.g-b--push--d10of12{margin-left:83.333%}.g-b--push--d1of8{margin-left:12.5%}.g-b--push--d3of8{margin-left:37.5%}.g-b--push--d5of8{margin-left:62.5%}.g-b--push--d7of8{margin-left:87.5%}.g-b--push--d1of10{margin-left:10%}.g-b--push--d3of10{margin-left:30%}.g-b--push--d7of10{margin-left:70%}.g-b--push--d9of10{margin-left:90%}.g-b--push--d1of12{margin-left:8.333%}.g-b--push--d5of12{margin-left:41.666%}.g-b--push--d7of12{margin-left:58.333%}.g-b--push--d11of12{margin-left:91.666%}.g-b--pull--d1of1{margin-right:100%}.g-b--pull--d1of2,.g-b--pull--d2of4,.g-b--pull--d3of6,.g-b--pull--d4of8,.g-b--pull--d5of10,.g-b--pull--d6of12{margin-right:50%}.g-b--pull--d1of3,.g-b--pull--d2of6,.g-b--pull--d4of12{margin-right:33.333%}.g-b--pull--d2of3,.g-b--pull--d4of6,.g-b--pull--d8of12{margin-right:66.666%}.g-b--pull--d1of4,.g-b--pull--d2of8,.g-b--pull--d3of12{margin-right:25%}.g-b--pull--d3of4,.g-b--pull--d6of8,.g-b--pull--d9of12{margin-right:75%}.g-b--pull--d1of5,.g-b--pull--d2of10{margin-right:20%}.g-b--pull--d2of5,.g-b--pull--d4of10{margin-right:40%}.g-b--pull--d3of5,.g-b--pull--d6of10{margin-right:60%}.g-b--pull--d4of5,.g-b--pull--d8of10{margin-right:80%}.g-b--pull--d1of6,.g-b--pull--d2of12{margin-right:16.666%}.g-b--pull--d5of6,.g-b--pull--d10of12{margin-right:83.333%}.g-b--pull--d1of8{margin-right:12.5%}.g-b--pull--d3of8{margin-right:37.5%}.g-b--pull--d5of8{margin-right:62.5%}.g-b--pull--d7of8{margin-right:87.5%}.g-b--pull--d1of10{margin-right:10%}.g-b--pull--d3of10{margin-right:30%}.g-b--pull--d7of10{margin-right:70%}.g-b--pull--d9of10{margin-right:90%}.g-b--pull--d1of12{margin-right:8.333%}.g-b--pull--d5of12{margin-right:41.666%}.g-b--pull--d7of12{margin-right:58.333%}.g-b--pull--d11of12{margin-right:91.666%}.splashscreen-dillinger{width:700px}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{font-size:1.25rem;margin-bottom:.89999rem;padding-top:.10001rem}.menu .menu-item--export-as{display:block}.menu .menu-item--preview{display:none}.settings a{font-size:1.25rem}.words,.characters{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog,#zen{font-size:1.25rem}#zen{width:700px}#editor{font-size:1rem}}@media screen and (min-width:87.5em){html{font-size:.875em}body{font-size:1rem}ul,ol{margin-bottom:.83999rem;padding-top:.16001rem}p{padding-top:.66001rem}p,pre{margin-bottom:1.33999rem}pre,blockquote p{font-size:1rem;padding-top:.66001rem}blockquote p{margin-bottom:.33999rem}h1{font-size:2.0571429rem;margin-bottom:.21999rem;padding-top:.78001rem}h2{font-size:1.953125rem;margin-bottom:.1835837rem;padding-top:.8164163rem}h3{font-size:1.6457143rem;margin-bottom:.07599rem;padding-top:.92401rem}h4{font-size:1.5625rem;margin-bottom:.546865rem;padding-top:.453135rem}h5{font-size:1.25rem;margin-bottom:-.56251rem;padding-top:.56251rem}h6{font-size:1rem;margin-bottom:-.65001rem;padding-top:.65001rem}.splashscreen-dillinger{width:800px}.splashscreen p{font-size:1.25rem;margin-bottom:1.43749rem;padding-top:.56251rem}.title{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.title-document{margin-bottom:.89999rem;padding-top:.10001rem}.title-document,.settings a{font-size:1.25rem}.words,.characters{font-size:.8rem;margin-bottom:.77999rem;padding-top:.22001rem}.modal--dillinger.about .modal-dialog,#zen{font-size:1.25rem}#editor{font-size:1rem}}@media (min-width:768px){.form-inline .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .input-group{display:inline-table;vertical-align:middle}.form-inline .input-group .input-group-addon,.form-inline .input-group .input-group-btn,.form-inline .input-group .form-control{width:auto}.form-inline .input-group>.form-control{width:100%}.form-inline .control-label{margin-bottom:0;vertical-align:middle}.form-inline .radio,.form-inline .checkbox{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.form-inline .radio label,.form-inline .checkbox label{padding-left:0}.form-inline .radio input[type="radio"],.form-inline .checkbox input[type="checkbox"]{position:relative;margin-left:0}.form-inline .has-feedback .form-control-feedback{top:0}.form-horizontal .control-label{text-align:right;margin-bottom:0;padding-top:7px}.form-horizontal .form-group-lg .control-label{padding-top:14.3px}.form-horizontal .form-group-sm .control-label{padding-top:6px}.modal-dialog{width:600px;margin:30px auto}.modal-content{box-shadow:0 5px 15px rgba(0,0,0,.5)}.modal-sm{width:300px}}@media (min-width:992px){.modal-lg{width:900px}}@media screen and (max-width:1200px){#_default_{max-width:30%}#_default_ ._default_{font-size:.825rem;line-height:.875rem;padding:12px 12px 6px 24px;text-align:justify}}@media screen and (max-width:1100px){#_default_{max-width:27%}#_default_ ._default_{font-size:.8rem;line-height:.85rem;padding:12px 6px 6px 24px;text-align:justify}}@media screen and (max-width:1000px){#_default_{max-width:24%}#_default_ ._default_{font-size:.775rem;line-height:.8rem;padding:12px 6px 6px 24px;text-align:justify}}@media screen and (max-width:900px){#_default_{max-width:30%}}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:15px;overflow-y:hidden;overflow-x:auto;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd;-webkit-overflow-scrolling:touch}.table-responsive>.table{margin-bottom:0}.table-responsive>.table>thead>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>tfoot>tr>td{white-space:nowrap}.table-responsive>.table-bordered{border:0}.table-responsive>.table-bordered>thead>tr>th:first-child,.table-responsive>.table-bordered>thead>tr>td:first-child,.table-responsive>.table-bordered>tbody>tr>th:first-child,.table-responsive>.table-bordered>tbody>tr>td:first-child,.table-responsive>.table-bordered>tfoot>tr>th:first-child,.table-responsive>.table-bordered>tfoot>tr>td:first-child{border-left:0}.table-responsive>.table-bordered>thead>tr>th:last-child,.table-responsive>.table-bordered>thead>tr>td:last-child,.table-responsive>.table-bordered>tbody>tr>th:last-child,.table-responsive>.table-bordered>tbody>tr>td:last-child,.table-responsive>.table-bordered>tfoot>tr>th:last-child,.table-responsive>.table-bordered>tfoot>tr>td:last-child{border-right:0}.table-responsive>.table-bordered>tbody>tr:last-child>th,.table-responsive>.table-bordered>tbody>tr:last-child>td,.table-responsive>.table-bordered>tfoot>tr:last-child>th,.table-responsive>.table-bordered>tfoot>tr:last-child>td{border-bottom:0}}@media screen and (max-width:720px){#_default_{max-width:60%}#_default_ ._default_{font-size:.75rem;line-height:1rem;padding:12px 24px}}@media screen and (max-width:620px){#_default_{max-width:50%}#_default_ ._default_{font-size:.66rem;letter-spacing:1px;line-height:1rem;padding:10px 24px}}@media screen and (max-width:520px){#_default_ ._default_{font-size:.4rem;line-height:.875rem;padding:6px 12px 6px 24px;text-align:justify}}@media screen and (max-width:460px){#_default_{display:none}}@media screen and (max-width:46.1875em){.editor-header{display:none}.editor-header--first{display:block;width:100%}}</style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1><a id="Bad_Apple_on_the_IBM_PC_5150_0"></a>Bad Apple on the IBM PC 5150</h1>

<p style="text-align:center;">
<iframe width="560" height="315" align="middle" src="https://www.youtube-nocookie.com/embed/eJ2FM5R-O_Y" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>

<p class="has-line-data" data-line-start="2" data-line-end="3">I’ve always been fascinated with the demoscene: impressive programs, such as <a href="https://www.youtube.com/watch?v=yHXx3orN35Y">8088 MPH</a> or <a href="https://www.youtube.com/watch?v=89wq5EoXy-0">State of the Art</a> making the most out of limited hardware in order to put on a show and mesmerize people. Demos are the best of two worlds that I love, low-level computer programming and audiovisual art.</p>
<p class="has-line-data" data-line-start="4" data-line-end="6">I’m also a huge fan of <a href="https://en.wikipedia.org/wiki/Touhou_Project">Touhou</a>, a japanese bullet-hell game series with great music that has gathered a huge community and derivative works by fans, such as <em>doujin</em> manga, animations, fan games and music. One of the most famous examples of a very popular Touhou-related work of art is the Bad Apple!! music video, a <em>shadow-art</em> clip accompanied by a vocal cover of the eponymous game track.<br>
This animation has been used as a demo for many different platforms ranging from the NES to the Commodore 64. Most of those demos use very large cartridge formats or large internal hard drives to store the animation and waste as little time as possible decoding data.</p>
<p class="has-line-data" data-line-start="7" data-line-end="8">My motivation for creating this demo was to explore the ways Bad Apple could be compressed on a symbolic 1.44Mb floppy disk and be played on a limited machine, juggling between compression efficiency and decompression speed.</p>
<p class="has-line-data" data-line-start="9" data-line-end="10">I was interested in programming for a 16-bit machine, because I expected 8-bit machines to be more of a hurdle and was feeling less confident with smaller word sizes. My choice landed on the original IBM PC 5150 from 1981, as it’s the grandfather of all PC-compatibles and one of the first users of the x86 architecture that I am familiar with. On top of that, there are many mature PC emulators available, which makes programming and debugging easier.</p>
<h2 class="code-line" data-line-start=11 data-line-end=12><a id="The_8088_11"></a>The 8088</h2>
<p class="has-line-data" data-line-start="13" data-line-end="14">At the center of the IBM PC 5150 lives a fairly interesting CPU, with a lot of potential and power but limited in many ways. Let’s study it in more detail.</p>
<h3 class="code-line" data-line-start=15 data-line-end=16><a id="16bit_ALU_8bit_data_bus_15"></a>16-bit ALU, 8-bit data bus</h3>
<p class="has-line-data" data-line-start="17" data-line-end="19">At the time of the IBM PC 5150 release in 1981, the personal computer ecosystem was still fairly small and populated by 8-bit machines such as the Apple II, the Commodore PET or the Commodore VIC-20, limited in their processing power, clocking at around 1 MHz and with a couple dozen kilobytes of RAM at most.<br>
For its time, the 5150 was quite the powerhouse, with a CPU clocked at 4.77Mhz capable of processing 16-bits numbers and up to 256KB of RAM.</p>
<p class="has-line-data" data-line-start="20" data-line-end="21">However, there was a caveat: the 8088 wasn’t truly 16-bit.</p>
<p class="has-line-data" data-line-start="22" data-line-end="23">Despite having a 16-bit ALU which means instructions can natively operate on 16-bit data, the 8088 had a 8-bit wide data bus : this means that in order to read or write a 16-bit value, two memory accesses must be made, as opposed to a true 16-bit CPU like the 8086.</p>
<p class="has-line-data" data-line-start="24" data-line-end="26"><img src="8088_buses.jpg" alt="8088 data bus widths"><br>
<em>The data buses of the 8088. From Michael Abrash’s</em> Graphics Programming Black Book.</p>
<p class="has-line-data" data-line-start="27" data-line-end="28">The 8086 like the 8088 possesses a buffer called the <em>prefetch queue</em>. The prefetch queue allows instructions to be fetched from memory when the instruction being executed doesn’t use the memory bus, in order to allow the Execution Unit to be fed continuously. Having to use a 8-bit data bus incurs a heavy penalty: whereas a 16-bit bus allows the prefetch buffer to be filled most of the time, a 8-bit bus means only half as many instructions can be prefetched. This implies that when using many fast instructions such as shifts, the prefetch buffer can be a bottleneck and stall the execution of the program, costing more cycles than expected.</p>
<p class="has-line-data" data-line-start="29" data-line-end="30">Therefore, in order to avoid losing cycles, it’s important to resort to byte-sized variables as much as possible in tight loops, and to schedule instructions so that the prefetch queue isn’t stalled.</p>
<h3 class="code-line" data-line-start=31 data-line-end=32><a id="Segment_addressing_31"></a>Segment addressing</h3>
<p class="has-line-data" data-line-start="33" data-line-end="37">The PC 5150 supports up to 256 kilobytes of memory, and the 8088 has a 20-bit address line. However, having 16-bit registers would mean that pointers can only address up to 64kB. How can we address the rest of the RAM?<br>
The solution used by the 8086 and therefore the 8088 is to use <em>segmented addressing</em>.<br>
The address space is divided into windows of 64 kB referred to as <em>segments</em>.<br>
Additional registers, named <em>segment registers</em>, provide additional address bits to create a logical 20-bit address out of a 16-bit pointer within a segment.</p>
<p class="has-line-data" data-line-start="38" data-line-end="39">Logical addresses are computed in the following manner:</p>
<pre><code>logical address = (segment register &lt;&lt; 4) + pointer
</code></pre>
<p class="has-line-data" data-line-start="41" data-line-end="42">where “&lt;&lt;” denotes the left bit shift operation.</p>
<p class="has-line-data" data-line-start="43" data-line-end="44">The following segment registers are available:</p>
<ul>
<li class="has-line-data" data-line-start="44" data-line-end="45">The Data Segment register or <em>ds</em>, used by default for all memory operands.</li>
<li class="has-line-data" data-line-start="45" data-line-end="46">The Code Segment register or <em>cs</em>, used for fetching instructions.</li>
<li class="has-line-data" data-line-start="46" data-line-end="47">The Stack Segment register or <em>ss</em>, used for stack accesses.</li>
<li class="has-line-data" data-line-start="47" data-line-end="49">The Extra Segment register or <em>es</em>, used by some instructions such as <em>stosb</em>.</li>
</ul>
<p class="has-line-data" data-line-start="49" data-line-end="50">Each instruction can use a different segment register through the use of a segment override prefix: this allows us to access different 64kB segments without having to reload <em>ds</em> for example.</p>
<h3 class="code-line" data-line-start=51 data-line-end=52><a id="Instruction_timings_and_quirks_51"></a>Instruction timings and quirks</h3>
<p class="has-line-data" data-line-start="53" data-line-end="54">Many modern processors such as the Pentium and later used many tricks such as superscalar execution (multiple instructions executed simultaneously), branch prediction, caches… to speed up execution. The 8088 has nothing of this, and save for the prefetch queue, is as simple as a processor can be regarding its execution flow.</p>
<p class="has-line-data" data-line-start="55" data-line-end="56">This may appear as a curse at first, because it means a lot of care will have to be spent optimizing the code to get the most out of every cycle, but this is also a blessing as the behavior of the CPU is much easier to understand and there’s no need to worry about caches, data locality and the like. As long as you make sure you take in account the prefetch queue and the 8-bit data bus penalties, cycle counting is easy and optimizing becomes a simpler task.</p>
<p class="has-line-data" data-line-start="57" data-line-end="58">My reference for instruction timings was this very well-made page: <a href="https://www2.math.uni-wuppertal.de/~fpf/Uebungen/GdR-SS02/opcode_i.html">https://www2.math.uni-wuppertal.de/~fpf/Uebungen/GdR-SS02/opcode_i.html</a>.</p>
<p class="has-line-data" data-line-start="59" data-line-end="61">A good rule of thumb is that the longer an instruction is in bytes (such as when using memory operands), the more cycles it takes to execute. Short instructions that operate on implicit operands or on registers are often very fast: the shift instructions which operate on a single register and a few others such as <em>cbw</em> which don’t need to pass through the ALU take as little as 2 cycles, regular arithemtic operations on registers take 3 cycles. However, instructions making memory accesses are both limited by the 8-bit bus and by the address generation hardware: complex addresses such as the ones generated using two registers and a displacement can add up to a 12 cycles penalty on top of the memory access cost!<br>
It is therefore important to make use of implicit operand instructions such as <em>lodsb/w</em> (load single byte/word), <em>stosb/w</em> (store single byte/word), or even stack instructions, which always use the <em>si</em>, <em>di</em> or <em>sp</em> registers, for maximum performance.</p>
<h3 class="code-line" data-line-start=62 data-line-end=63><a id="Memory_map_used_for_the_demo_62"></a>Memory map used for the demo</h3>
<p class="has-line-data" data-line-start="64" data-line-end="65">The demo uses the full 256 kB of RAM that the IBM PC 5150 can use. The demo could probably use as little as 64kB through a more clever usage of music data streaming, but I unfortunately ran out of time and could not explore this possibility properly.</p>
<p class="has-line-data" data-line-start="66" data-line-end="67">The memory map used by the program is as follows:</p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Address range</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00000-0x0FFFF</td>
<td>BIOS data area, stack</td>
</tr>
<tr>
<td>0x10000-0x1FFFF</td>
<td>Lower 64kB of music</td>
</tr>
<tr>
<td>0x20000-0x2FFFF</td>
<td>Code, animation buffers</td>
</tr>
<tr>
<td>0x30000-0x3FFFF</td>
<td>Upper 64kB of music</td>
</tr>
</tbody>
</table>
<p class="has-line-data" data-line-start="75" data-line-end="76">The music data range is not contiguous, however that is not a concern as segment registers allows for easily switching between 64kB ranges.</p>
<h2 class="code-line" data-line-start=77 data-line-end=78><a id="The_VGA_77"></a>The VGA</h2>
<p class="has-line-data" data-line-start="78" data-line-end="79"><em>(Note : I highly recommend reading the related chapters in Michael Abrash’s Graphics Programming Black Book of which you can find copies online. This was my main reference, along with the <a href="https://archive.org/details/programmersguidetotheegavgaandsupervgacardsbyrichardf.ferraro19943rdedition/page/n307/mode/2up">Programmer’s Guide to the EGA, VGA and Super VGA Cards)</a>.</em></p>
<p class="has-line-data" data-line-start="80" data-line-end="81">The original IBM PC 5150 shipped with either a MDA card which could display 80x25 monochrome text or a CGA card capable of limited graphics modes, up to 640x200 pixels in monochrome. However, the palette is fixed, and the addressing scheme is complicated due to the limitations of the video hardware (odd and even lines aren’t contiguous). Because this was my first experience with programming for old PC hardware and I wanted to have fun with more complex hardware, I decided to go for the famous VGA card, which was released much later. It’s a plausible choice, as a <a href="http://minuszerodegrees.net/5150/bios/5150_bios_revisions.htm">BIOS firmware update released in 1982</a> allowed support for video cards with extension ROMs, thus supporting later hardware.</p>
<p class="has-line-data" data-line-start="82" data-line-end="85">Unlike modern video cards, the VGA compatible cards don’t expose a linear framebuffer where every pixel is mapped to a certain address. The VGA BIOS exposed <a href="https://www.fountainware.com/EXPL/video_modes.htm">multiple video modes</a> supporting different resolutions and color counts. Due to how the video RAM is implemented in hardware, in all modes except mode 0x13 the screen data is accessed using <strong>planes</strong>, with each video RAM bank on the card corresponding to a plane. The VGA card can be configured in order to select which planes to write to.<br>
<img src="vga_planar.gif" alt="VGA planar mode"><br>
<em>How each pixel is stored in video RAM in planar modes.</em></p>
<p class="has-line-data" data-line-start="86" data-line-end="88">Each pixel is represented as 4 bits which map into a palette of 16 colors in order to determine which color to be drawn on screen. Bit 0 of the first pixel maps to the first bit of plane 0, bit 1 maps to the first bit of plane 1, and so on.<br>
The <a href="https://web.stanford.edu/class/cs140/projects/pintos/specs/freevga/vga/seqreg.htm">Map Mask Register</a> selects which planes to be written to : this allows for one cpu write to change up to 4 planes at once. (this is what made the infamous Mode X used in Wolfenstein 3D and Doom so efficient: by modifying the linear mode 0x13 to use the planar hardware, four pixels could be modified in a single write!)</p>
<p class="has-line-data" data-line-start="89" data-line-end="90">I settled on using mode $0xD (320x200, 4 colors) as a basis, which I would slightly modify using the VGA registers according to my needs. Because I wanted to preserve the original aspect ratio of the video and have a width that is a multiple of 16 pixels, that implied using a 256x192 display area.</p>
<h3 class="code-line" data-line-start=91 data-line-end=92><a id="Juggling_with_palettes_91"></a>Juggling with palettes</h3>
<p class="has-line-data" data-line-start="93" data-line-end="94">Up to 256 colors are supported, but the 4 planes only allow 16 individual colors on screen. How did the video controller map those 4-bit pixels to that color range?</p>
<p class="has-line-data" data-line-start="95" data-line-end="97">768 bytes of palette RAM are used for storing 6-bit RGB values for each of the 256 colors. These colors can be set using the <a href="http://www.osdever.net/FreeVGA/vga/colorreg.htm">DAC registers</a>.<br>
Before being used to select a palette RAM color, the 4 bits of plane data are fed into an internal palette of 16 bytes. This internal palette maps plane values into 6 bits that are fed into the palette RAM. If this feels unnecessary, then you are correct! This step is a relic from the EGA which didn’t have the extended support for palette change the VGA has, and was kept because of backwards compatibility reasons. In order to make things cleared, I will refer to the 16-bytes palette as <em>internal palette</em> and the 768 bytes palette as the <em>palette RAM</em>.</p>
<p class="has-line-data" data-line-start="98" data-line-end="99">The <a href="http://www.osdever.net/FreeVGA/vga/attrreg.htm">Attribute Mode Control and Color Select registers</a> control how these bits are fed to the palette RAM. The <em>P54S</em> bit is used to select the bits 5-6 fed to the palette RAM from the internal palette or from the lowest 2 bits of the Color Select register. Bits 7-8 are taken from the highest 2 bits of the Color Select register.</p>
<p class="has-line-data" data-line-start="100" data-line-end="102"><img src="16_banks.png" alt="16 banks"><br>
<em>The VGA Behaviour in 16 banks mode.</em></p>
<p class="has-line-data" data-line-start="103" data-line-end="105"><img src="4_banks.png" alt="4 banks"><br>
<em>The VGA Behaviour in 4 banks mode.</em></p>
<p class="has-line-data" data-line-start="106" data-line-end="107">In essence, this allows us to quickly switch between ‘banks’ of 16 or 64 colors palettes, by changing the Color Select register.</p>
<h3 class="code-line" data-line-start=108 data-line-end=109><a id="Palette_doublebuffering_108"></a>Palette double-buffering</h3>
<p class="has-line-data" data-line-start="109" data-line-end="110">The VGA video controller refreshes the screen at a 70Hz frequency. The 8088 is not nearly powerful enough to update the video data at that speed: therefore, the screen might display multiple frames that are currently being modified: this is a problem known as <em>tearing</em>, that is often solved in modern computers by using two buffers, and displaying the one that has been updated.</p>
<p class="has-line-data" data-line-start="111" data-line-end="113">One cool property of the Color Select register is that it allows us to perform double-buffering without having to use a second buffer of video memory. Because I chose to display a purely black&amp;white version of Bad Apple, I only use 1 plane out of the 4 planes available.<br>
By alternating between plane 0 and plane 1, it is possible to modify animation data in one plane while retaining the display frame intact in the other plane, avoiding tearing effects.</p>
<p class="has-line-data" data-line-start="114" data-line-end="115">In addition to that, the <em>Color Plane Select</em> register allows selecting which planes to write to, including multiple at once. It is therefore possible to maintain a frame on multiple planes, one for the display and another for modification. Using <a href="http://www.osdever.net/FreeVGA/vga/vgamem.htm">Write Mode 0</a> which allows data from video memory to be latched and combined with input data using a logical operation, and configuring the appropriate registers, it would have been possible to implement delta-encoding by only modifying the changed bytes of each frame, using a XOR operation on the saved previous frame. The good results of regular encoding meant that this option wasn’t necessary, but I kept the palette double-buffering as it was already working well.</p>
<h3 class="code-line" data-line-start=116 data-line-end=117><a id="The_chosen_palette_116"></a>The chosen palette</h3>
<p class="has-line-data" data-line-start="118" data-line-end="119">The palette I’ve settled upon is the following:</p>
<table class="table table-striped table-bordered">
<thead>
<tr>
<th>Plane 0</th>
<th>Plane 1</th>
<th>Plane 2</th>
<th>Plane 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Page 0</td>
<td>Page 1</td>
<td>Shade</td>
<td>Negate</td>
</tr>
</tbody>
</table>
<p class="has-line-data" data-line-start="123" data-line-end="127">Planes 0 et 1 (which correspond to bits 0 and 1 of the corresponding palette index) contain the binary data of the animation (black or white). The palette entries are set up so that on the first palette, the plane 1 doesn’t change the color, and on the second palette, plane 0 doesn’t change the color.<br>
Changing the active palette therefore changes which plane is the one displayed on-screen.<br>
Plane 2 is used to shade the color displayed, by mapping black pixels to dark grey and white pixels to light grey when set. Plane 3 inverts the color display if set.<br>
These planes are used to display the kanji on each side of the screen using shaded tones for a better visual result, for the progress of the lyrics bar at the bottom, and for the sound bars using the negate plane.</p>
<p class="has-line-data" data-line-start="128" data-line-end="129"><img src="palettes.png" alt="Palettes"></p>
<p class="has-line-data" data-line-start="130" data-line-end="132"><em>On the left: the palette used when Plane 0 is the active plane.</em><br>
<em>On the right: the palette used when Plane 1 is the active plane.</em></p>
<h2 class="code-line" data-line-start=133 data-line-end=134><a id="Compression__decompression_133"></a>Compression &amp; decompression</h2>
<p class="has-line-data" data-line-start="135" data-line-end="137">As established earlier, a 256x192 resolution at 15 fps has been chosen for the animation, following a guesstimate of what could reliably be rendered in time by the 8088 and what could fit in 1.44MB. That leaves us with 3286 frames, which amount to about 20 MB of uncompressed data. How can we possibly make that 20x smaller?<br>
Luckily, we know some useful properties about the data we’re processing, but we’re also going to have to deal with the limitations of 8088.</p>
<h3 class="code-line" data-line-start=138 data-line-end=139><a id="Getting_the_video_frames_138"></a>Getting the video frames</h3>
<p class="has-line-data" data-line-start="140" data-line-end="141">Before even thinking about compression techniques, we need to extract the date we’re going to be working on. For that purpose, I used the excellent tool <strong>ffmpeg</strong> and its frame extraction feature using the following command on the music video:</p>
<pre><code class="has-line-data" data-line-start="142" data-line-end="144" class="language-bash">$ ffmpeg -i video.mp4 -vf fps=<span class="hljs-number">15</span>,scale=<span class="hljs-number">256</span>:<span class="hljs-number">192</span> <span class="hljs-number">320</span>x200_nodither/frame-%d.png
</code></pre>
<p class="has-line-data" data-line-start="144" data-line-end="145">We get 3286 frames at a 256x192 resolution. Those files are included as part of the github repository.</p>
<h3 class="code-line" data-line-start=146 data-line-end=147><a id="Some_compression_strategies_146"></a>Some compression strategies</h3>
<h4 class="code-line" data-line-start=148 data-line-end=149><a id="RLE_Encoding_148"></a>RLE Encoding</h4>
<p class="has-line-data" data-line-start="149" data-line-end="151">The first strategy that springs to mind is to use some form of <a href="https://en.wikipedia.org/wiki/Run-length_encoding">run-length encoding</a> (or RLE, in short). It’s a very simple format that is very easy and efficient to decode, simply encoding the number of times a certain symbol is repeated. One could implement RLE considering single bits (a pixel), bytes (8 consecutive pixels) or words (16 pixels) as the symbols to repeat. Using single bits has the advantage of not requiring specifying which symbol to repeat, as the new pixel to be repeated will always be the inverse of the previous one. It is however more costly to decode, as the 8088 works on operands no smaller than bytes and its bit manipulation instructions are costly.<br>
I chose a symbol length of a word (16 pixels) as it gave a marginally better compression ratio than a byte width, while making the code slightly more efficient. Even though the 8088 data bus is 8 bits wide, it’s still cheaper to issue a single <code>stosw</code> than two <code>stosb</code> and at least a bookkeeping instruction along them.</p>
<p class="has-line-data" data-line-start="152" data-line-end="155">The way the image is traversed for the encoding of RLE data is important. Due to the nature of the animation (most frames fill vertical space with thin characters), it is more efficient to use a <strong>column-major order</strong>: this way, fewer transitions are encountered, as many vertical line are plain black or white, or are very similar.<br>
<img src="traversal.png" alt="2D Image traversal"><br>
A quick benchmark using my compression code shows that column-major encoding is about 1.5x more efficient.</p>
<p class="has-line-data" data-line-start="156" data-line-end="159">These are not the only way to traverse a 2D matrix. Some other space filling curves, like the z-order curve or the Hilbert curve tend to preserve locality better, and lessen the amount of color transitions.<br>
<img src="zcurve.png" alt="Z-order curve"><br>
This saves a small amount of space thus and leads to more efficient compression. It complicates the decompression code slightly, requiring a table lookup to convert the traversal index to the corresponding coordinates. The overhead is small, but the gain in compression efficiency was too small to justify the added complexity, and I preferred using the execution time budget to accomplish other tasks.</p>
<h4 class="code-line" data-line-start=160 data-line-end=161><a id="Quadtrees_160"></a>Quadtrees</h4>
<p class="has-line-data" data-line-start="162" data-line-end="163">By virtue of being black&amp;white images, the frames could lend themselves to some form of <a href="https://en.wikipedia.org/wiki/Quadtree">quadtree</a> encoding. Using such a data structure, the largest areas of plain black or white as well as the smaller details can be compressed efficiently. Quadtrees require a square area to work with, but the 256x192 screen can easily be divided in a 192x192 square and three 64x64 squares. However, I found that the RLE encoding efficiency was turning out to be promising enough, and I was uncertain about how better would a quadtree approach be. I was also afraid about the complexity and inefficiency of the decoding process, therefore I chose to focus on the RLE approach.</p>
<p class="has-line-data" data-line-start="164" data-line-end="165"><img src="quadtree.png" alt="Encoding a monochrome image as a quadtree"><em>Encoding a monochrome image as a quadtree.</em></p>
<h4 class="code-line" data-line-start=166 data-line-end=167><a id="Contour_coding_166"></a>Contour coding</h4>
<p class="has-line-data" data-line-start="167" data-line-end="170">The Bad Apple animation is a famous case of shadow art: black silhouettes being projected onto a white background. The silhouettes might be large, but most of the time there’s only one displayed on a frame, as a unified blob of black or white pixels. This sounds like a very interesting property, and while doing research on the subject I stumbled upon this <a href="https://www.researchgate.net/publication/283905980_A_Compressed_Representation_of_Mid-Crack_Code_with_Huffman_Code">very interesting paper</a> about <strong>contour coding</strong>.<br>
Essentially, each “blob” of data of each frame can be defined by its <em>contour</em>, that is by the sequence of pixels that define its outline. This sequence can be further described as a succession of pixels that is offset from the previous one by a certain direction.<br>
As this direction can be described in as little as 2 bits (as with the Crack coding scheme shown below), this could lead to a very efficient encoding of frame data, possibly combined with some sort of Huffman encoding. I expect this approach to be too expensive to decode for a 8088, but this could lead to very satisfying results for higher resolutions where RLE might fail, and more efficient CPUs.</p>
<p class="has-line-data" data-line-start="171" data-line-end="173"><img src="contourcode.png" alt="Contour coding schemes"><br>
<em>Contour coding schemes, describing how to encode the offset between a pixel of the contour and its successor.</em></p>
<h4 class="code-line" data-line-start=173 data-line-end=174><a id="The_elephant_in_the_room_temporal_locality_and_delta_encoding_173"></a>The elephant in the room: temporal locality and delta encoding</h4>
<p class="has-line-data" data-line-start="175" data-line-end="179">By now, you might be shouting at your screen, wondering why the hell didn’t I implement some form of delta encoding, updating only the parts of the screen that change between each frames, utilizing the temporal locality of the animation.<br>
Well, I meant to do that at first, developing a double-buffering system based on palette switching that I will explain later that would allow using the VGA card facilities to implement this with some amount of ease.<br>
However, I realized while experimenting with encoding schemes that while combining delta-encoded frames and regular frames leads to best efficiency, delta-encoding alone is vastly inferior to no delta-encoding at all. As the 8088 turned out to be able to pump out full 256x192 frames at 15fps as I desired, I decided that the extra complexity wasn’t worth the trouble.<br>
It might likely end up being an essential approach for larger resolutions and/or faster framerates, though!</p>
<h3 class="code-line" data-line-start=180 data-line-end=181><a id="Improving_RLE_efficiency_180"></a>Improving RLE efficiency</h3>
<p class="has-line-data" data-line-start="181" data-line-end="182">A naive implementation of RLE is not efficient enough for our own purposes. However, there are properties of the animation that we can exploit in order to yield better results, utilizing different coding strategies. These strategies are divided into ten RLE “commands”, as follows:</p>
<ul>
<li class="has-line-data" data-line-start="182" data-line-end="184">
<p class="has-line-data" data-line-start="182" data-line-end="183">Repeat: This command corresponds to regular RLE: a single word is repeated n times, in column-major order.</p>
</li>
<li class="has-line-data" data-line-start="184" data-line-end="186">
<p class="has-line-data" data-line-start="184" data-line-end="185">RepeatLine: a single line filled with the same 16px block is repeated n times.</p>
</li>
<li class="has-line-data" data-line-start="186" data-line-end="188">
<p class="has-line-data" data-line-start="186" data-line-end="187">ShiftedSequence: Many 16px blocks can be divided into two parts of different color. This command encodes a sequence of such “shifted” blocks, encoding the position of the split between the colors instead of the entire 16px block for better space efficiency.</p>
</li>
<li class="has-line-data" data-line-start="188" data-line-end="190">
<p class="has-line-data" data-line-start="188" data-line-end="189">RepeatShifted: This command is similar to the one above, but repeats a single block n times instead of a sequence of shifted blocks.</p>
</li>
<li class="has-line-data" data-line-start="190" data-line-end="192">
<p class="has-line-data" data-line-start="190" data-line-end="191">RepeatXor: Many 16px blocks only differ from the previous one by a single pixel. This commands repeats a block that can be obtained from the previous one XOR’d with a specific lookup table.</p>
</li>
<li class="has-line-data" data-line-start="192" data-line-end="194">
<p class="has-line-data" data-line-start="192" data-line-end="193">RawBlock16: This command encodes a sequence of 16px blocks that cannot be more efficiently encoded by other methods.</p>
</li>
<li class="has-line-data" data-line-start="194" data-line-end="195">
<p class="has-line-data" data-line-start="194" data-line-end="195">EndOfFrame: Signals the end of the current frame. It might also be followed by data related to the sound bar effect and the lyrics progression.</p>
</li>
<li class="has-line-data" data-line-start="195" data-line-end="197">
<p class="has-line-data" data-line-start="195" data-line-end="196">EndOfLine: Signals the end of a line, and that the decoder code should jump to the next column.</p>
</li>
<li class="has-line-data" data-line-start="197" data-line-end="198">
<p class="has-line-data" data-line-start="197" data-line-end="198">EndOfData: Signals the end of the animation data.</p>
</li>
</ul>
<h3 class="code-line" data-line-start=200 data-line-end=201><a id="How_do_I_decode_that_Tradeoffs_between_compression_efficiency_and_decoding_speed_200"></a>How do I decode that? Tradeoffs between compression efficiency and decoding speed</h3>
<p class="has-line-data" data-line-start="202" data-line-end="205">While hunting for the best compression methods, I somewhat neglected to take the complexity of the encoding in account. I used Huffman encoding to a ridiculous extent for the RLE commands based on the frequency at which they appeared, which led to very efficient encoding (about 900kB and 90% entropy according to binwalk, close to the efficiency of the .zip DEFLATE algorithm). It’s however <strong>a major pain to decode, as the 8088 is very inefficient at bit-level operations.</strong> The variable shift instruction <a href="https://www2.math.uni-wuppertal.de/~fpf/Uebungen/GdR-SS02/opcode_i.html">can take up to 36 cycles</a> to execute in the worst case on a register: that’s more than 7.5μs spent on each RLE command of each frame.<br>
Taking inspiration from bytecode interpreters using <a href="https://en.wikipedia.org/wiki/Threaded_code">threaded code</a> (which has nothing to do with multithreading!), I decided to code each RLE command as a single byte followed by one or more data bytes, encoding as many common-case scenarios in a single byte.<br>
The decompression algorithm in a simplified form is as follows:</p>
<pre><code class="has-line-data" data-line-start="206" data-line-end="213">load a single byte from the compressed data stream
convert the byte into an offset into a jump table
load the jump target from the table
jump to the section of the code corresponding to the RLE command loaded
(...command completes)
(the process is repeated at the end of the command code)
</code></pre>
<p class="has-line-data" data-line-start="213" data-line-end="214">As many commands and their data can be encoded into a single byte, this allows some commands to be “compiled” in advance using assembler directives: as we know in advance the data contained in the command byte, we can output code that is directly unrolled or optimized for the specific command.</p>
<p class="has-line-data" data-line-start="215" data-line-end="216">All in all, this set of commands and appropriate size optimisations led to a total of 1262KB being used for the animation data, leaving 178KB to be used for music and code.</p>
<h2 class="code-line" data-line-start=217 data-line-end=218><a id="The_floppy_subsystem_217"></a>The floppy subsystem</h2>
<p class="has-line-data" data-line-start="219" data-line-end="221">The <em>raison d’être</em> of this demo was to be able to store Bad Apple on floppies and run them on the fly, without having to use a dedicated hard drive; a challenge in compression first and foremost.<br>
The IBM PC 5150 floppy controllers supports up to four 5.25&quot; 360k floppies; but it also partially supports later 3.5&quot; 720k floppies, even though the BIOS floppy routines are somewhat bugged in that regard. In order to simplify the code somewhat, I chose to go with the two 720k floppy option.</p>
<p class="has-line-data" data-line-start="222" data-line-end="223">One thing to note about floppies is that they’re extremely slow: using the BIOS routines, reading a 512-bytes sector takes around 100ms, which is absolutely not acceptable when we need to be streaming data from the floppy out to the screen at 15fps!</p>
<p class="has-line-data" data-line-start="224" data-line-end="227">Floppies contain one or more heads reading a disk side. Disks are separated in different circular parts called cylinders. A cylinder is made out of two tracks, corresponding to the top and bottom sides of the disk. Each cylinder is further divided into multiple sectors of 512 bytes.<br>
The disks are spinning continuously at a predetermined rotation speed (300 RPM for a 3.5&quot; floppy) : in order to read a sector, the floppy controller has to wait for the right sector to come in front of the head. Then, as the disk spins, the head reads the data bytes.<br>
This means that reading a sector and reading an entire cylinder takes a similar amount of time: the controller must wait for the disk to bring the sector in front of the head, once this is done, it’s just a matter of reading consecutive data as the disk rotates.</p>
<p class="has-line-data" data-line-start="228" data-line-end="229"><img src="chs.png" alt="Floppy CHS"></p>
<h3 class="code-line" data-line-start=229 data-line-end=230><a id="Floppy_DMA_229"></a>Floppy DMA</h3>
<p class="has-line-data" data-line-start="231" data-line-end="232">A big disadvantage of using BIOS functions is that they’re blocking: apart from interrupt handlers, no other code can be run while data is being read. This is rather unfortunate, as the BIOS accesses the floppy using <a href="https://en.wikipedia.org/wiki/Direct_memory_access">DMA</a>, which means that the floppy controllers takes care of reading the data into memory by itself, lightening the charge on the CPU. There is a slowdown as the memory bus is used by both the CPU fetching instructions and the DMA controller, but it’s nonetheless much better than blocking I/O.</p>
<p class="has-line-data" data-line-start="233" data-line-end="235">This means that we’ll have to write a floppy driver by ourselves: a daunting task, especially since floppies are famously unreliable, and figuring out the correct controller configuration is sometimes akin to black magic. Thankfully, there were <a href="https://forum.osdev.org/viewtopic.php?t=13538">many resources</a> <a href="http://www.isdaman.com/alsos/hardware/fdc/floppy.htm">along the way</a> to help.<br>
Writing our own separate driver also allows us finer control over the hardware. In order to read from a floppy, the disk motor needs to spin up to speed; the BIOS manages when to power the motor on or off based on a timer we don’t have control over. As we’re going to continuously read data from the floppies, we can keep the motors on for the entire duration of the animation.</p>
<p class="has-line-data" data-line-start="236" data-line-end="237">This way, the floppy controller can read up to a cylinder at once; that is 2<em>9</em>512 = 9216 bytes on a 720k floppy with 9 sectors per track and 2 heads.</p>
<h3 class="code-line" data-line-start=238 data-line-end=239><a id="Streaming_animation_data_from_the_floppies_238"></a>Streaming animation data from the floppies</h3>
<p class="has-line-data" data-line-start="240" data-line-end="241">Each frame of the animation data is packed in multiple cylinders of 9216 bytes. If a frame crosses a boundary, it is pushed back to the next cylinder.</p>
<p class="has-line-data" data-line-start="242" data-line-end="243">At any point during the playback of the animation, a cylinder is being read into memory by the floppy controller. As soon as the last frame of the current cylinder is played, the following occurs:</p>
<ul>
<li class="has-line-data" data-line-start="244" data-line-end="245">The current cylinder load command is acknowledged: this frees the floppy controller and allows us to send a new request.</li>
<li class="has-line-data" data-line-start="245" data-line-end="246">The code seeks the head to the next cylinder: this takes a few milliseconds at most, as because the cylinders are consecutive the distance required for the head to travel is minimal.</li>
<li class="has-line-data" data-line-start="246" data-line-end="247">A request to read the next cylinder using DMA is sent.</li>
<li class="has-line-data" data-line-start="247" data-line-end="248">The animation data base pointer is changed to point to the cylinder that was just loaded.</li>
<li class="has-line-data" data-line-start="248" data-line-end="250">If we’ve reached the last cylinder of the first floppy: select the second drive as the active floppy drive.</li>
</ul>
<p class="has-line-data" data-line-start="250" data-line-end="251">For that purpose, two 9216 byte blocks are reserved in the main data segment, in order to store the cylinder containing the frames being played and the cylinder being loaded by the floppy controller. In a manner similar to double-buffering, the pointer referring to the start of the data to play is changed each time a cylinder is loaded.</p>
<h2 class="code-line" data-line-start=252 data-line-end=253><a id="Music_252"></a>Music</h2>
<p class="has-line-data" data-line-start="254" data-line-end="256">Demos are all about making the most out of impressive hardware in an impressive manner: it’s a <em>scene</em>. This is especially true of Bad Apple, a music video that wouldn’t be whole without the famous Alstroemeria Records track.<br>
However, we are limited by the size constraints of using floppies, and about 128KB are left for music. A quick calculation shows that using audio sample data is out of the question, as it would require megabytes of storage. More clever compression schemes like <a href="https://en.wikipedia.org/wiki/Adaptive_differential_pulse-code_modulation">ADPCM</a> which cards such as the Sound Blaster 16 could natively play wouldn’t be enough. A different approach is required.</p>
<h3 class="code-line" data-line-start=257 data-line-end=258><a id="FM_Synthesis_257"></a>FM Synthesis</h3>
<p class="has-line-data" data-line-start="259" data-line-end="263">Instead of playing back sampled sound, it is much more size efficient to generate the soundwaves on the fly, using PC sound hardware cards such as the Sound Blaster Pro 2. This card contained a <strong>Yamaha OPL3</strong> chip, which uses <a href="https://en.wikipedia.org/wiki/Frequency_modulation_synthesis">FM synthesis</a> to create sound, giving it a unique sonority.<br>
FM synthesis works by modulating the frequency and the envelope of waveforms such as sine waves or sawtooth waves. The sound chip can be <a href="https://www.fit.vutbr.cz/~arnost/opl/opl3.html">programmed</a> to output different kinds of sounds using registers which control different channels that can be tuned and combined. Just like sheet music is a way to conceptualize and reproduce songs by specifying which notes to play at which rhythm, FM synthesis songs are stored as a sequence of registers to be modified instead of pure audio sample data, which is much more space efficient.<br>
Luckily for us, DOSBox can record the register commands sent while playing a song as a <a href="https://moddingwiki.shikadi.net/wiki/DRO_Format">DRO file</a>, a simple list of register-value pairs.<br>
By playing <a href="https://www.youtube.com/watch?v=2lEPH6Y3Luo">this excellent cover</a> of Bad Apple for the OPL3 made by NAB622 using <a href="http://adlibtracker.net/files/adtrack2.htm">Adlib Tracker</a>, I was able to save the commands sent to the sound chip as a 500KB file.</p>
<p class="has-line-data" data-line-start="264" data-line-end="265">Unfortunately, 500KB is still a far cry away from the 128KB required. Naively compressing the DRO file using a lossless scheme doesn’t cut it: the command information is already stored quite efficiently. We’re going to need some form of lossy compression.</p>
<h3 class="code-line" data-line-start=266 data-line-end=267><a id="Compressing_FM_synthesis_music_266"></a>Compressing FM synthesis music</h3>
<p class="has-line-data" data-line-start="268" data-line-end="269">Most commands sent to the OPL3 chip are changing the frequency or output level played by a specific channel. For effects such as portamentos, those changes are continuous and thus most registers only changes by a few units. A first approach is therefore to elide all register update commands such as the difference in value is below a predetermined threshold.</p>
<p class="has-line-data" data-line-start="270" data-line-end="271">The commands sent to the OPL3 chips are gathered in what I call “basic blocks”, separated by delay markers. The registers in “basic blocks” are supposed to be set instantaneously, and if there are two or more writes to the same register in a block, the last write is the one effective. The DRO file output by DOSBox contains many instances of multiple writes to the same register: by simplifying basic blocks, I found that I was able to reduce the size of the file by half.</p>
<p class="has-line-data" data-line-start="272" data-line-end="273">Another optimization is to reduce the frequency at which commands are sent to the sound chip. The source DRO file contains many 1ms or 4ms delays between basic blocks. By merging such blocks until delays reach a certain threshold, and subsequently removing the necessary register writes, we can obtain a great increase in compression efficiency.</p>
<p class="has-line-data" data-line-start="274" data-line-end="275">Obtaining a final file size below 128KB was then just a matter of tuning the two thresholds until a pleasing result was obtained.</p>
<h3 class="code-line" data-line-start=276 data-line-end=277><a id="Playing_music_in_realtime_276"></a>Playing music in real-time</h3>
<p class="has-line-data" data-line-start="278" data-line-end="280">As the floppy controller will be busy reading animation data, it’s not possible to stream music data progressively. It would have been possible to embed OPL3 commands along each animation frame, but given that 128KB of RAM are available, I chose to preload the music in memory before the demo starts.<br>
The music data is stored at the end of the second floppy: it is read after boot into addresses 0x10000-0x1FFFF and 0x30000-0x3FFFF: these address ranges are not contiguous, but that is not a problem as they correspond to different segments; we simply have to change the segment register value when switching from the first half to the second half of the data.</p>
<p class="has-line-data" data-line-start="281" data-line-end="283">A routine is set up to run each 1ms by programming Channel 0 of the timer chip to fire an interrupt at a 1000Hz frequency. This routine first checks if a delay is active and non-null: if it is, the delay value is decremented. If there’s no need for a delay, the appropriate registers are loaded with the segment to use and the OPL3 I/O address. The next basic block is read, and for each command pair, the appropriate I/O instructions are used to change the OPL3 registers.<br>
A command can be marked as “extracode”: in that case, it does not refer to a OPL3 register but to a delay, a segment switch marker or to the end-of-song marker.</p>
<p class="has-line-data" data-line-start="284" data-line-end="286">If the segment switch marker is encountered, the instruction in the prologue of the routine is modified in order to load the segment corresponding to the second half of the song. This kind of self-modifying code is possible and optimal because the 8088 has no instruction cache and no need to maintain consistency between memory and what’s executed by the CPU: self-modifying code is almost never the answer, but in old hardware, it’s a very convenient trick when a part of the code flow needs to be changed in certain scenarios, instead of resorting to a jump or a memory access that would occur a cycle penalty for each call.<br>
A similar trick is used for the end-of-song marker, replacing the prologue of the routine with a jump to the exit when there’s no more music to be played.</p>
<h2 class="code-line" data-line-start=287 data-line-end=288><a id="Extra_visual_candy_287"></a>Extra visual candy</h2>
<p class="has-line-data" data-line-start="289" data-line-end="290">An animation resolution of 256x192 leaves us with 64 pixels of extra horizontal space and 8 bytes of vertical space. As there was some time budget left after decoding and playing a frame and sending the music data to the OPL3 chip, I decided to put those extra pixels to good use and display both lyrics and dynamic sound bars.</p>
<p class="has-line-data" data-line-start="291" data-line-end="292"><img src="screencap.png" alt="Screen capture"></p>
<h3 class="code-line" data-line-start=292 data-line-end=293><a id="Kanji_art_and_sound_bars_292"></a>Kanji art and sound bars</h3>
<p class="has-line-data" data-line-start="294" data-line-end="297">After loading the code data from the first floppy drive, plane 0 and 1 are both filed with the kanji <em>東方幻想郷</em>, as a nod to the Touhou game the original “Bad Apple!!” track is from. Plane 2, the <em>shading</em> plane, is used to provide some kind of smoothing using half-tone colors in order to make the kanji look less “sharp”.<br>
Plane 3, the <em>negate</em> plane, is filled after each frame up to a height specified in the frame data, corresponding to the current “sound level”; emulating an equalizer display.<br>
Using a separate plane as a “negate bit” for each pixel allows the code to easily implement such functionality without having to redraw the kanji with the correct color 15 times per second. Each frame contains a byte corresponding to the difference in height between the sound bars of the previous frame and the current one, allowing the code to easily update only the rows of pixels that need to be changed.</p>
<h3 class="code-line" data-line-start=298 data-line-end=299><a id="Karaoke_lyrics_298"></a>Karaoke lyrics</h3>
<p class="has-line-data" data-line-start="300" data-line-end="302">8 pixels of vertical space isn’t much, but it’s just enough to show text using a 8x8 font.<br>
Bad Apple is a pretty popular karaoke song, so using that space for lyrics seemed like an obvious choice!</p>
<p class="has-line-data" data-line-start="303" data-line-end="305">Here again, having a separate plane for shading has proven to be useful: white and grey pixels can be used to display the progression of the song through the lyrics.<br>
For that purpose, each frame contains an additional byte that represent the “progression”, using 3 bits to represent the position within a character, and the other 5 bits to represent which character is currently being “sung”.</p>
<p class="has-line-data" data-line-start="306" data-line-end="307">Two routines for drawing text (one for drawing multiple characters and one for drawing only the first n columns of a character) are used to display the lyrics. First, when a frame signals a change in the lyrics to display, the full lyrics line is drawn in both planes 0, 1 and 2 in order to display text in grey. Then, as the lyrics progress through each frame, the characters that are being and have been sung are cleared from plane 2, in order to display them as white.</p>
<p class="has-line-data" data-line-start="308" data-line-end="309">This is a pretty cheap solution that doesn’t cost many cycles, and storing the lyrics progression in the frame data would allow for a non-linear progression, for example including pauses and syllables being sung faster than others. I didn’t implement this kind of thing due to lack of time, but it would be pretty easy to do so.</p>
<p class="has-line-data" data-line-start="310" data-line-end="312"><img src="lyrics.gif" alt="Lyrics progression GIF"><br>
<em>How the lyrics appear on-screen during the animation.</em></p>
<h2 class="code-line" data-line-start=313 data-line-end=314><a id="Testing_the_demo_a_choice_of_emulators_313"></a>Testing the demo: a choice of emulators</h2>
<p class="has-line-data" data-line-start="315" data-line-end="316">Unfortunately, IBM PC 5150s are hard to come by these days, as so are floppies and Sound Blaster cards. In order not to ruin both my wallet and my sanity, I decided to test my code using some PC emulators.</p>
<p class="has-line-data" data-line-start="317" data-line-end="318">The most important thing about demomaking, and what makes it fun, is having to program under constraints of time and/or space. Many emulators are not cycle-accurate, nor simulate floppy delays properly; or don’t support some of the more obscure VGA registers. It’s therefore important to make sure not to make a demo that only works well on emulators that “cheat”!</p>
<p class="has-line-data" data-line-start="319" data-line-end="320">For testing whether or not my code works within the tight cycle constraints of the original machine and its quirks, I used <a href="https://github.com/86Box/86Box">86box</a>, a PC emulator that has a cycle-accurate emulation of the 8088 and its ecosystem. As a testament to its quality, it’s as far as I know the only emulator capable of running the <a href="https://www.youtube.com/watch?v=CWDRSx1LYTU">famous 8088 MPH demo!</a></p>
<p class="has-line-data" data-line-start="321" data-line-end="322">For quicker prototyping and debugging purposes however, I used both <a href="https://www.qemu.org/">QEMU</a> and <a href="https://bochs.sourceforge.io/">bochs</a>. QEMU’s emulation is extremely fast and has a debug console that can display the contents of registers, but it lacks support for emulating the Sound Blaster Pro 2.0 card. Bochs is a dinosaur and is pretty slow, but it emulates the sound card properly and has many interesting debugging features such a “magic breakpoints” that pauses the execution when a certain point in the code is reached. Those features were essential in figuring out how to make the floppy controller and the decompression code work.</p>
<h2 class="code-line" data-line-start=324 data-line-end=325><a id="Running_the_demo_324"></a>Running the demo</h2>
<p class="has-line-data" data-line-start="326" data-line-end="327">The code used for the demo, the generation of compressed animation data and music data is available on the project’s repository at <a href="https://github.com/Stellaris-code/BadApple5150">https://github.com/Stellaris-code/BadApple5150</a>.</p>
<p class="has-line-data" data-line-start="328" data-line-end="330">In order to execute the demo, your emulator needs to be configured to run a IBM 5150 PC using the updated 1982 BIOS, with a VGA card, a Sound Blaster Pro 2 or Sound Blaster 16 card, and 2 720k floppies loaded with the fat.img and fat2.img files.<br>
I suggest using the excellent and accurate 86box emu for that purpose, though bochs should work too if properly configured (the <a href="http://bochs.sh">bochs.sh</a> file should contain the appropriate settings).</p>
<p class="has-line-data" data-line-start="331" data-line-end="332">More detailed instructions for running the demo are available in the <a href="https://github.com/Stellaris-code/BadApple5150">README</a>.</p>
<h2 class="code-line" data-line-start=333 data-line-end=334><a id="Concluding_333"></a>Concluding</h2>
<p class="has-line-data" data-line-start="335" data-line-end="336">At first, the slow performance of the 8088 and the VGA feels like an impossible challenge to overcome. And yet, the more I worked on programming this demo, the more I’ve come to appreciate what this weak processor by today’s standards could do if used properly.</p>
<p class="has-line-data" data-line-start="337" data-line-end="338">Programming on a 16-bit x86 CPU was very interesting to me: the instructions used are mostly the same as modern x86 processors, yet having to resort to segment registers, being restricted in the usage of addressing modes and stack because of performance concerns was challenging and exhilarating. Squeezing as much work as possible out of each cycle feels very satisfying and is akin to solving puzzles, in which you have to select the most appropriate instructions and chain them in interesting and unusual ways.</p>
<p class="has-line-data" data-line-start="339" data-line-end="341">And still, I think much more could be done. The compression algorithm, as simple and efficient as it is, only works well on more “blocky” resolutions. The higher amount of detail of 640x480 resolutions and above, or the presence of dithering, defeat the techniques used in the demo. Algorithms exploiting temporal locality better and only changing the pixels that need to be changed would likely allow for more detail on the PC 5150. This might also allow higher framerates: I think reaching a 30fps playback speed might be in the real of possibility using more clever compression methods.<br>
Furthermore, I resorted to using the popular VGA card, which was only released in 1987, 6 years after the original release of the 5150. Adapting the code to use the EGA instead might be feasible. The memory layout of CGA data might however be too big of a hurdle, as this card stored the even rows first, followed by the odd rows: this would require a big rework of the decompression code.</p>
<p class="has-line-data" data-line-start="342" data-line-end="343">The Sound Blaster Pro 2 card was also anachronistic, being released 10 years after the 5150. Clever developers have been able to use the <a href="https://github.com/xdsopl/pcspkr">original PC Speaker to play digital sound</a> : it might be possible if very cycle-heavy to play the tune of Bad Apple this way.</p>
<p class="has-line-data" data-line-start="344" data-line-end="345">Overall, this experience got me very invested in programming for constrained environments, and demomaking is the perfect embodiment of that: I will likely give Z80 or 6502-based machines such as the legendary Amstrad CPC or Commodore 64 a go next.</p>
</body></html>